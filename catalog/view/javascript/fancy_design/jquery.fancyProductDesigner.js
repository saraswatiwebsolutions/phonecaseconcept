var fancyProductDesignerFilterImg = 'data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAGQAAABkCAIAAAD/gAIDAAAAGXRFWHRTb2Z0d2FyZQBBZG9iZSBJbWFnZVJlYWR5ccllPAAAA1ZpVFh0WE1MOmNvbS5hZG9iZS54bXAAAAAAADw/eHBhY2tldCBiZWdpbj0i77u/IiBpZD0iVzVNME1wQ2VoaUh6cmVTek5UY3prYzlkIj8+IDx4OnhtcG1ldGEgeG1sbnM6eD0iYWRvYmU6bnM6bWV0YS8iIHg6eG1wdGs9IkFkb2JlIFhNUCBDb3JlIDUuMC1jMDYwIDYxLjEzNDc3NywgMjAxMC8wMi8xMi0xNzozMjowMCAgICAgICAgIj4gPHJkZjpSREYgeG1sbnM6cmRmPSJodHRwOi8vd3d3LnczLm9yZy8xOTk5LzAyLzIyLXJkZi1zeW50YXgtbnMjIj4gPHJkZjpEZXNjcmlwdGlvbiByZGY6YWJvdXQ9IiIgeG1sbnM6eG1wTU09Imh0dHA6Ly9ucy5hZG9iZS5jb20veGFwLzEuMC9tbS8iIHhtbG5zOnN0UmVmPSJodHRwOi8vbnMuYWRvYmUuY29tL3hhcC8xLjAvc1R5cGUvUmVzb3VyY2VSZWYjIiB4bWxuczp4bXA9Imh0dHA6Ly9ucy5hZG9iZS5jb20veGFwLzEuMC8iIHhtcE1NOk9yaWdpbmFsRG9jdW1lbnRJRD0iQzA2NTAzMzhGRDBGRjNDNTQ2NjQ5MTdERjU4RTZBOUYiIHhtcE1NOkRvY3VtZW50SUQ9InhtcC5kaWQ6NDJBOTU5NjZBQTVFMTFFNDg3MTc5QzUzNEZBREI5NjIiIHhtcE1NOkluc3RhbmNlSUQ9InhtcC5paWQ6NDJBOTU5NjVBQTVFMTFFNDg3MTc5QzUzNEZBREI5NjIiIHhtcDpDcmVhdG9yVG9vbD0iQWRvYmUgUGhvdG9zaG9wIENTNiAoV2luZG93cykiPiA8eG1wTU06RGVyaXZlZEZyb20gc3RSZWY6aW5zdGFuY2VJRD0ieG1wLmlpZDozNDlGNUFEOERDNDhFNDExOThFMDgyRUM1NERENjU5QSIgc3RSZWY6ZG9jdW1lbnRJRD0iQzA2NTAzMzhGRDBGRjNDNTQ2NjQ5MTdERjU4RTZBOUYiLz4gPC9yZGY6RGVzY3JpcHRpb24+IDwvcmRmOlJERj4g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';

//change fabricjs cursormap
fabric.Canvas.prototype.cursorMap = ['default', 'default', 'default', 'se-resize', 'default', 'default', 'default', 'default'];
var rotateIcon = new Image(),
	resizeIcon = new Image(),
	removeIcon = new Image(),
	copyIcon = new Image();

//set data url rotate icon
rotateIcon.src = 'data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAUCAYAAACNiR0NAAAABGdBTUEAALGPC/xhBQAAACBjSFJNAAB6JgAAgIQAAPoAAACA6AAAdTAAAOpgAAA6mAAAF3CculE8AAAACXBIWXMAAAsTAAALEwEAmpwYAAABWWlUWHRYTUw6Y29tLmFkb2JlLnhtcAAAAAAAPHg6eG1wbWV0YSB4bWxuczp4PSJhZG9iZTpuczptZXRhLyIgeDp4bXB0az0iWE1QIENvcmUgNS40LjAiPgogICA8cmRmOlJERiB4bWxuczpyZGY9Imh0dHA6Ly93d3cudzMub3JnLzE5OTkvMDIvMjItcmRmLXN5bnRheC1ucyMiPgogICAgICA8cmRmOkRlc2NyaXB0aW9uIHJkZjphYm91dD0iIgogICAgICAgICAgICB4bWxuczp0aWZmPSJodHRwOi8vbnMuYWRvYmUuY29tL3RpZmYvMS4wLyI+CiAgICAgICAgIDx0aWZmOk9yaWVudGF0aW9uPjE8L3RpZmY6T3JpZW50YXRpb24+CiAgICAgIDwvcmRmOkRlc2NyaXB0aW9uPgogICA8L3JkZjpSREY+CjwveDp4bXBtZXRhPgpMwidZAAAC/0lEQVQ4EYWVu0tkUQyHc8cnVmI3inYitoKlpdjaWQ3iP7AIFrtoLwx2i42NaKWCjZVoY2PnaOcDUfE1F0FQ1MLnvdl8mTmXcZZlA2dy7knyS06Sk4nEaGtr60d3d/ev1tbWvFYo4vx/FEWR2ore3t7im5ub4sjIyG8He35+ruJowiZNU1/ZYZJ8+66Tu83Ly4sSWHR0dFTu7+/v/DIyxUYD8cDMsYR9U1OTJEniK5fLuRwZERpFDQ0NX41Gx8fHcc6u2WkaqRk0mrJiEIzgAJmi8+bmZneCM2RwA1NswQArhwv7yAVvuOeIRWRtbW2ysrIi6+vrDsBZxQRNIUQzjRzD9goghy7lhz2eW1paxHIrpVLJIywUCrKxsSGfn58uJ/JgFzDgcnZ25gl/f39X1sfHB1fQvb09HR4expP29vY6Z7+7u2t2qpZy18XGquwYYFUyXI3MmFhuxYxkcHBQDEgODg5kbGwMkczOzkpfX59Y8eTp6cl5yLcr8BMifH19dc/X19cezczMjIazyclJnZ6eVloDOj091fHxced8Bz2wMkDChpaWlhwQYAiQnZ0dfXh48GuRjqurK9cpFotZuuhNACm3E6GTcK44NTUl+Xzev6nq0NCQ61h+vV26urpkc3NTLAixXHqRqjCSAYYDQNvb213JAnROztjjFM7CCWAQ34GyonBAuwB2e3vr0dUCIAOYM4Dm5+dlcXHRbZBlVF+U7e1tz8/+/r45Vm+l0FIhzycnJ66zurrqOrVtU1sUnp9aO+jExERqHtWenBvQc8gsHV6ku7s7XVtb0/v7+xSFb1U+Pz/3Q4siDZ4uLy91dHTUo5ibm9M4jjFWqjowMKCHh4fuKERuxXIMsOTi4gJhgpBXAocAWF5ezq5PtES9sLCg5XLZX0qdTQIW4yu28ZW3a9WOL7XJ4m/88fFRmDIknjbp6OjwvYFRIJxExn18WW7jfw5Yckaz1hNnyGro+4Cl3Ezanp6enzZhOquKFlBlwNIq7FmhbYLM+F9/AX8AdQud0FqHQBoAAAAASUVORK5CYII=';
//set data url resize icon
resizeIcon.src = 'data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAUCAYAAACNiR0NAAAABGdBTUEAALGPC/xhBQAAACBjSFJNAAB6JgAAgIQAAPoAAACA6AAAdTAAAOpgAAA6mAAAF3CculE8AAAACXBIWXMAAAsTAAALEwEAmpwYAAABWWlUWHRYTUw6Y29tLmFkb2JlLnhtcAAAAAAAPHg6eG1wbWV0YSB4bWxuczp4PSJhZG9iZTpuczptZXRhLyIgeDp4bXB0az0iWE1QIENvcmUgNS40LjAiPgogICA8cmRmOlJERiB4bWxuczpyZGY9Imh0dHA6Ly93d3cudzMub3JnLzE5OTkvMDIvMjItcmRmLXN5bnRheC1ucyMiPgogICAgICA8cmRmOkRlc2NyaXB0aW9uIHJkZjphYm91dD0iIgogICAgICAgICAgICB4bWxuczp0aWZmPSJodHRwOi8vbnMuYWRvYmUuY29tL3RpZmYvMS4wLyI+CiAgICAgICAgIDx0aWZmOk9yaWVudGF0aW9uPjE8L3RpZmY6T3JpZW50YXRpb24+CiAgICAgIDwvcmRmOkRlc2NyaXB0aW9uPgogICA8L3JkZjpSREY+CjwveDp4bXBtZXRhPgpMwidZAAAC6UlEQVQ4EYVUv0tjQRCefb5ECRoIpDEYDUkjSoqU6QUr/QvExs5Cy7s61Vme/4CFoDYBKyFtGiWQiCBKQLSQJKX4kxiTt/d9Q/Zx8TgysG93Z2a/+fnGCKhSqeyk0+mfU1NTs0EQWLAM+ePIGGOxTLfbbT8+Pu6trq7uK9jLy4sd0oA7QbkcubvjuftQrm9eX18tHTO3t7etxcXF1NfXV9/zPB9LoCgwrDv46qi78+LO2IlpJiYm+j4IWG1/cnIyBZ2AYBcXF7bRaJjp6Wnp9/vy9vYmKysrsry8LIPBIAR2oNzxzkJGvAApS/l0n3xYsfV63ezu7lJP6fj4WBYWFhTMee1kw50u0mPFoLseBMqkYGZmJtQvFouSz+clHo+HvP8d8NZhGAI6MgyTVCgU5Pz8XLa3t+Xy8pJhKZ9Gx5FquiSjUnJ0dCQHBwcKWq1WZXNzUzqdjkQiES3SOEC5u7uDYWvRS/bq6so+Pz/rvVar2VQqZWHAfnx8WFTbfn5+hqvX61m3yGctiGX4yWazAqGgUgKBOsEwW62WJJNJicVigkfaLuTD4khr8R6NRuX+/l7CHDJsgjlltsn8/LwqEoxANEg5z04f3RHmmJ6EgA6IilwkAtEI7wR5f3+Xw8NDQTo0p8wrexUpCd+EgARwQO5MEBJ3GiyXy7K1tSXr6+tyfX2tQOzVp6cn1WNUvp7GfOglQ1taWtJ1c3MjpVJJcrmcnJ2dqYEQgkXBA1YvcFXD/vdZK0sZCf+r3djYYENyBfDWttttlTWbTeshTI6g0MDwMMKgnF5yYcxJJpNx+oaVBWnHE8vHh485qwjuFEd2yLTCbPyTkxM5PT3VMB8eHvQHcBjIteejoTt4PcsRxKlBJCgwBNUjGIne0SCGqKytrbkCqlIikeA/6yMtbR+T9tfc3NxvDAYdQRB4BCPId+Kg+DYsNDro+fSeU1sfctKiiX9wNtI10D+A9A7873PRIkpDz0B7mJ37fwDDzTkRRcDc5gAAAABJRU5ErkJggg==';
//set data url remove icon
removeIcon.src = 'data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAUCAYAAACNiR0NAAAABGdBTUEAALGPC/xhBQAAACBjSFJNAAB6JgAAgIQAAPoAAACA6AAAdTAAAOpgAAA6mAAAF3CculE8AAAACXBIWXMAAAsTAAALEwEAmpwYAAABWWlUWHRYTUw6Y29tLmFkb2JlLnhtcAAAAAAAPHg6eG1wbWV0YSB4bWxuczp4PSJhZG9iZTpuczptZXRhLyIgeDp4bXB0az0iWE1QIENvcmUgNS40LjAiPgogICA8cmRmOlJERiB4bWxuczpyZGY9Imh0dHA6Ly93d3cudzMub3JnLzE5OTkvMDIvMjItcmRmLXN5bnRheC1ucyMiPgogICAgICA8cmRmOkRlc2NyaXB0aW9uIHJkZjphYm91dD0iIgogICAgICAgICAgICB4bWxuczp0aWZmPSJodHRwOi8vbnMuYWRvYmUuY29tL3RpZmYvMS4wLyI+CiAgICAgICAgIDx0aWZmOk9yaWVudGF0aW9uPjE8L3RpZmY6T3JpZW50YXRpb24+CiAgICAgIDwvcmRmOkRlc2NyaXB0aW9uPgogICA8L3JkZjpSREY+CjwveDp4bXBtZXRhPgpMwidZAAACw0lEQVQ4EYWVPU9qQRCG9xwOQrCWRBNIoKOhobSh0t9BbwBNyCUE+mt7fwQtUNoQNRb+AiVRG8jlq+RDEPHsfd8Je3L4SO4kG93d2WfenTM7WAp2d3eXj8Vi5XA4fOq6rsaSxfX/mWVZGsNaLpf9Xq93e3l5+Udgk8lE0wD7gWkOgjdr8j/nZpj1jd8P59PpVFOY9fLy8jeVSp19f3+vocgJBoMKjgpzZdu2gu+WUAhSAMve0dERg1uYr3HOeX197du45hkOuYQx4sPDgxoMBgrrAiPUPxgAIAny+PhIXx0IBBwyyFIfHx+8J+bavb+/pxx9dXWlx+Mx1/RisdCr1UoGcqXX67WkpNVqiW+5XNbz+Vzy8/b25qr393dxANRFYgVGaLFY1KPRSKAEGRiBzWZTYPRrt9sSjI5kCZDJphIalRFG5+vraw+KnIo6P+zp6UnO8AZkbAGNCnpQmYHm83nv+o1Gw1Pmhxkxe0BGMpuEEkal1WpV1+v1g7Cvry/NcVAhgdykWhqvX6vVPFA6ndbPz8+yR1/6mb8GaEPBlrHOaEi+Ojk5UahRbz+TyahEIuHts5z2jPcm3R+NX5LD5IzKcrmcKC0UCno4HIpKU1I8axR6X9lc1cBMnUGBXJM5JYxz/9cn7CCQ0VjgBB4qDUqiMsII3a3TPYVIrkuVG2V8itpfGp+fn3JNf0nd3Ny4fHoUQTFSNoee3i7M5NdfUoCJ0kqlsvX0HPYzGN+znUwmFd6muri4UOfn59JxcBVpDgii0AQUbqGi0agqlUrSQLLZrEKnYWm42LfZvvoojVPIXqMMHKhgN2F0C0EOtjDCHcchXBMGkJztdDp9Gw3hN5ojHajWPT4+log8wBbG/sh2tTvgqyKRiIV9l0Jms5nqdru3UsXstPF4/FcoFDpjcpkD2F5zpTK/8StBnQWlfcL4E/AP1Ru/hjA7dpIAAAAASUVORK5CYII=';
//set data url copy icon
copyIcon.src = 'data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACgAAAAoCAYAAACM/rhtAAAAGXRFWHRTb2Z0d2FyZQBBZG9iZSBJbWFnZVJlYWR5ccllPAAAA2ZpVFh0WE1MOmNvbS5hZG9iZS54bXAAAAAAADw/eHBhY2tldCBiZWdpbj0i77u/IiBpZD0iVzVNME1wQ2VoaUh6cmVTek5UY3prYzlkIj8+IDx4OnhtcG1ldGEgeG1sbnM6eD0iYWRvYmU6bnM6bWV0YS8iIHg6eG1wdGs9IkFkb2JlIFhNUCBDb3JlIDUuMC1jMDYwIDYxLjEzNDc3NywgMjAxMC8wMi8xMi0xNzozMjowMCAgICAgICAgIj4gPHJkZjpSREYgeG1sbnM6cmRmPSJodHRwOi8vd3d3LnczLm9yZy8xOTk5LzAyLzIyLXJkZi1zeW50YXgtbnMjIj4gPHJkZjpEZXNjcmlwdGlvbiByZGY6YWJvdXQ9IiIgeG1sbnM6eG1wTU09Imh0dHA6Ly9ucy5hZG9iZS5jb20veGFwLzEuMC9tbS8iIHhtbG5zOnN0UmVmPSJodHRwOi8vbnMuYWRvYmUuY29tL3hhcC8xLjAvc1R5cGUvUmVzb3VyY2VSZWYjIiB4bWxuczp4bXA9Imh0dHA6Ly9ucy5hZG9iZS5jb20veGFwLzEuMC8iIHhtcE1NOk9yaWdpbmFsRG9jdW1lbnRJRD0ieG1wLmRpZDowMTgwMTE3NDA3MjA2ODExOEE2RDlFMzNBNzM3REJDNyIgeG1wTU06RG9jdW1lbnRJRD0ieG1wLmRpZDowNUE4NkE1QkY4OUYxMUU0QjE0NEVCN0VBQjE0QUYyMCIgeG1wTU06SW5zdGFuY2VJRD0ieG1wLmlpZDowNUE4NkE1QUY4OUYxMUU0QjE0NEVCN0VBQjE0QUYyMCIgeG1wOkNyZWF0b3JUb29sPSJBZG9iZSBQaG90b3Nob3AgQ1M1IE1hY2ludG9zaCI+IDx4bXBNTTpEZXJpdmVkRnJvbSBzdFJlZjppbnN0YW5jZUlEPSJ4bXAuaWlkOjAxODAxMTc0MDcyMDY4MTE4QTZEQUI2OTEzMjkzN0EwIiBzdFJlZjpkb2N1bWVudElEPSJ4bXAuZGlkOjAxODAxMTc0MDcyMDY4MTE4QTZEOUUzM0E3MzdEQkM3Ii8+IDwvcmRmOkRlc2NyaXB0aW9uPiA8L3JkZjpSREY+IDwveDp4bXBtZXRhPiA8P3hwYWNrZXQgZW5kPSJyIj8+x3L2tAAABFxJREFUeNrsmUtIW1kYx788fD9QY0DtYihFJLsp4qtQEEEsKtQqo4giqODCuhmEURA3LmVKu3FjFypofaCoNGiFAVEYwY0LQZ2OdGEVJTUj0aDGqHG+/yFXot68vEl00Q8OJveenPs73/tcVWtrayQnV1dXGJH8UUPBlzOVSnXB484NrQxYFP95HRYWlsfjKf8oApeDCKdyOBwWu93+78XFxV/8vAVX0BuAPLE0JiamW6/XGyIiIkij0ZDcrgItsBbDkdVq/cNsNs/y52Z+7u4NQIZ7lZSU9CklJSVOrVZTKAVKCA8PJ51OFx4bG/t6e3tbb7PZ3jDHD7VkVtbcu9TU1JDD3RZYLi0t7QVb7y2+S4BFycnJhlCY0xeJjo6m+Pj4FraqTg37czC8jIqKehx0TmGLJrHCnmsByOrUKVnMZDIROzddXl7eCSqsj2vsPsRW8nlNrVZL7G5PpCBRlEZaW1tpdnZWQADodgBwdArfGhoaoqysLH+WDtMGwhzQXkdHBzU0NMgCzs/PU01NDVVVVdHo6Kg/kFcBAUSKYB+mhIQEt+YqKiqiwsJCKi8vp7GxMcrLy/PN1B7rz9kZra+v0/HxsdsEGxkZSe3t7SKpuxP4Juc1am5uRr6liooKmpqaouzsbGWAW1tbVFpaKnwLWrhtPsje3h6VlJRQT0+PTxppaWkR/lhbW0uDg4NeIT0CYtfISdgtVxmxe1ffgjQ2NlJfXx8dHh5Sf3+/MLecpnd3d2lhYUFsNCcnh3Jzc6m4uJjm5uYoMzPzfoCAwG45aQpQd3O6u7tpcXGRqqurRaTC7K7ClUGs09nZKb6jWmEOrnV1ddH09PT9AKXdw4fcyfn5OSUmJtLAwIDwLUTryMgIkv/1HEQtIlmygLM4iM0MDw97fH5ACi8eyJmfjEaj2ExdXZ0IsOuHsMZwPy4uTgxYBFEPq3ir/YoB0SatrKzQ0tISLS8vU1NTk9BWfX09nZycePytJ8v4bGJvAgcfHx8XPgh/hOnS09NpcnKSKisrqaysTNH6igGRA1HqpICBuWE2pCeLxaLYfRQDQmOuASEJEncgesugdadySf1RAQZKfgL+BAz2CS7oacZTo4GxurpKm5ubd84qgEN341oSQw6IPDgzMyNqNNosuTkFBQUPA4jOBbW2ra1NVBp3Z25vydwrIBZAB+J3iXJ24FJ9Dkqpw+LohHt7e/2G3NjYCMiLJwlQdiW0+fn5+TQxMeFXXYV5DQYDZWRkKK6YWmcHcip3F6064B5CsEnmOlIDkNv2r2g8H5Nw+mFGx7raSfuFT2X/PRY4aO/o6GielfdV7QyGfw4ODj66O6CHWsxms+P09PQDc11KgKD+c2dn5zOTB6yXu8/5xmQynezv77dxUBoFm+tbfudb/d84pfzOp65f+RCuCsVLTSR0u91+ZrVajTab7T3D/X2d6uT+DcHaxCn9F574DF09BfctP16iWnh8Y2V853HjWf8LMAB0YMuB3kGOawAAAABJRU5ErkJggg==';

//----------------------------------
// ------- Fabric.js Methods ----------
//----------------------------------


fabric.Object.prototype._drawControl = function(control, ctx, methodName, left, top) {
	var size = this.cornerSize;
	if (this.isControlVisible(control)) {

		var icon = false;
		if (control == 'tr' || control == 'br' || control == 'mtr' || control == 'tl') {
			switch (control) {
				case 'tr':
					icon = this.params.removable ? removeIcon : false;
					break;
				case 'br':
					icon = this.params.resizable ? resizeIcon : false;
					break;
				case 'mtr':
					icon = this.params.rotatable ? rotateIcon : false;
					break;
				case 'tl':
					icon = this.params.isInitial !== true && !this.params.hasUploadZone ? copyIcon : false;
					break;
			}

		}

		this.transparentCorners || ctx.clearRect(left, top, size, size);
		if (icon !== false) {
			ctx.drawImage(icon, left, top, size, size);
			ctx[methodName](left, top, size, size);
		}
	}
};
fabric.Object.prototype.findTargetCorner = function(pointer) {
	if (!this.hasControls || !this.active) return false;
	var ex = pointer.x,
		ey = pointer.y,
		xPoints, lines;
	for (var i in this.oCoords) {
		if (!this.isControlVisible(i)) {
			continue;
		}
		if (i === 'mtr' && !this.hasRotatingPoint) {
			continue;
		}
		if (this.get('lockUniScaling') && (i === 'mt' || i === 'mr' || i === 'mb' || i === 'ml')) {
			continue;
		}
		lines = this._getImageLines(this.oCoords[i].corner);
		xPoints = this._findCrossPoints({
			x: ex,
			y: ey
		}, lines);
		if (xPoints !== 0 && xPoints % 2 === 1) {
			this.__corner = i;
			return i;
		}
	}
	return false;
};
fabric.IText.prototype.initHiddenTextarea = function() {
	this.hiddenTextarea = fabric.document.createElement('textarea');
	this.hiddenTextarea.setAttribute('autocapitalize', 'off');
	this.hiddenTextarea.style.cssText = 'position: absolute; top: 0; left: -100px; opacity: 0; width: 0; height: 0; z-index: -99999;';
	this.canvas.wrapperEl.appendChild(this.hiddenTextarea);
	fabric.util.addListener(this.hiddenTextarea, 'keydown', this.onKeyDown.bind(this));
	fabric.util.addListener(this.hiddenTextarea, 'keypress', this.onKeyPress.bind(this));
	fabric.util.addListener(this.hiddenTextarea, 'copy', this.copy.bind(this));
	fabric.util.addListener(this.hiddenTextarea, 'paste', this.paste.bind(this));
	if (!this._clickHandlerInitialized && this.canvas) {
		fabric.util.addListener(this.canvas.upperCanvasEl, 'click', this.onClick.bind(this));
		this._clickHandlerInitialized = true;
	}
};

/**
 * @name fabric
 * @class
 * @ignore
 */

/**
 * @name fabric.CurvedText
 * @class
 * @ignore
 */


/**
 * @name fabric.Object
 * @class
 * @memberof fabric
 * @ignore
 */

/**
 * @name FancyProductDesigner
 * @class
 * @param {HTMLElement} elem - HTML element to initialize instance on.
 * @param {Object} [opts] - The default options.
 */
var FancyProductDesigner = function(elem, opts) {

	/** @lends FancyProductDesigner.prototype */

	// @@include('../envato/evilDomain.js')

	$ = jQuery;

	//merge the default options with the own set options
	var options = $.extend({}, $.fn.fancyProductDesigner.defaults, opts);
	options.elementParameters = $.extend({}, $.fn.fancyProductDesigner.defaults.elementParameters, options.elementParameters);
	options.textParameters = $.extend({}, $.fn.fancyProductDesigner.defaults.textParameters, options.textParameters);
	options.imageParameters = $.extend({}, $.fn.fancyProductDesigner.defaults.imageParameters, options.imageParameters);
	options.customTextParameters = $.extend({}, $.fn.fancyProductDesigner.defaults.customTextParameters, options.customTextParameters);
	options.customImageParameters = $.extend({}, $.fn.fancyProductDesigner.defaults.customImageParameters, options.customImageParameters);
	options.customAdds = $.extend({}, $.fn.fancyProductDesigner.defaults.customAdds, options.customAdds);
	options.dimensions = $.extend({}, $.fn.fancyProductDesigner.defaults.dimensions, options.dimensions);
	options.labels = $.extend({}, $.fn.fancyProductDesigner.defaults.labels, options.labels);

	/*function _testZ() {

		var objects = stage.getObjects();
		for (var i=0; i< objects.length; ++i) {
			var obj = objects[i];
				title = obj.title === undefined ? obj.name : obj.title;
			console.log(i, title +' on view:' + obj.viewIndex);
		}

	};*/

	//public variables
	var version = '3.0.31',
		thisClass = this,
		$window = $(window),
		$body = $('body'),
		$products,
		$designs,
		$elem,
		$initText,
		$mainContainer,
		$productStage,
		$contextDialog,
		$contextLoader,
		$colorPicker,
		$elementTooltip,
		$viewSelection,
		$editorBox,
		$fullLoader,
		stage,
		$productCategories = null,
		productCategories = [],
		$designCategories = null,
		designCategories = {},
		currentBoundingObject = null,
		currentUploadZone = null,
		viewsLength = 0,
		currentProductIndex = -1,
		currentViewIndex = 0,
		currentViews = null,
		currentElement = null,
		currentPrice = 0,
		responsiveScale = 1,
		viewOptions = {},
		mouseDownStage = false,
		dragStage = false,
		grabStartPointer,
		viewportPosition = new fabric.Point(0, 0),
		nonInitials = [],
		undos = [],
		redos = [],
		productCreated = false,
		startIndexUndo,
		endIndexUndo,
		$currentLazyLoadContainer = null,
		stageCleared = false,
		localStorageAvailable = true,
		instaAccessToken = null,
		tempLayerListItemTop;


	$elem = $(elem).width(options.width).addClass('fpd-container fpd-clearfix').before('<p class="fpd-initiliazing">'+options.labels.initText+'<br /><img src="data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHZpZXdCb3g9IjAgMCAzMiAzMiIgd2lkdGg9IjMyIiBoZWlnaHQ9IjMyIiBmaWxsPSJibGFjayI+CiAgPGNpcmNsZSB0cmFuc2Zvcm09InRyYW5zbGF0ZSg4IDApIiBjeD0iMCIgY3k9IjE2IiByPSIwIj4KICAgIDxhbmltYXRlIGF0dHJpYnV0ZU5hbWU9InIiIHZhbHVlcz0iMDsgNDsgMDsgMCIgZHVyPSIxLjJzIiByZXBlYXRDb3VudD0iaW5kZWZpbml0ZSIgYmVnaW49IjAiCiAgICAgIGtleXRpbWVzPSIwOzAuMjswLjc7MSIga2V5U3BsaW5lcz0iMC4yIDAuMiAwLjQgMC44OzAuMiAwLjYgMC40IDAuODswLjIgMC42IDAuNCAwLjgiIGNhbGNNb2RlPSJzcGxpbmUiIC8+CiAgPC9jaXJjbGU+CiAgPGNpcmNsZSB0cmFuc2Zvcm09InRyYW5zbGF0ZSgxNiAwKSIgY3g9IjAiIGN5PSIxNiIgcj0iMCI+CiAgICA8YW5pbWF0ZSBhdHRyaWJ1dGVOYW1lPSJyIiB2YWx1ZXM9IjA7IDQ7IDA7IDAiIGR1cj0iMS4ycyIgcmVwZWF0Q291bnQ9ImluZGVmaW5pdGUiIGJlZ2luPSIwLjMiCiAgICAgIGtleXRpbWVzPSIwOzAuMjswLjc7MSIga2V5U3BsaW5lcz0iMC4yIDAuMiAwLjQgMC44OzAuMiAwLjYgMC40IDAuODswLjIgMC42IDAuNCAwLjgiIGNhbGNNb2RlPSJzcGxpbmUiIC8+CiAgPC9jaXJjbGU+CiAgPGNpcmNsZSB0cmFuc2Zvcm09InRyYW5zbGF0ZSgyNCAwKSIgY3g9IjAiIGN5PSIxNiIgcj0iMCI+CiAgICA8YW5pbWF0ZSBhdHRyaWJ1dGVOYW1lPSJyIiB2YWx1ZXM9IjA7IDQ7IDA7IDAiIGR1cj0iMS4ycyIgcmVwZWF0Q291bnQ9ImluZGVmaW5pdGUiIGJlZ2luPSIwLjYiCiAgICAgIGtleXRpbWVzPSIwOzAuMjswLjc7MSIga2V5U3BsaW5lcz0iMC4yIDAuMiAwLjQgMC44OzAuMiAwLjYgMC40IDAuODswLjIgMC42IDAuNCAwLjgiIGNhbGNNb2RlPSJzcGxpbmUiIC8+CiAgPC9jaXJjbGU+Cjwvc3ZnPg==" /></p>');

	$initText = $elem.prev('.fpd-initiliazing');
	$products = $elem.children('.fpd-category').size() > 0 ? $elem.children('.fpd-category').remove() : $elem.children('.fpd-product').remove();
	$designs = $elem.children('.fpd-design');

	//test if browser is supported (safari, chrome, opera, firefox IE>9)
	var canvasTest = document.createElement('canvas'),
		canvasIsSupported = Boolean(canvasTest.getContext && canvasTest.getContext('2d'));

	if(!canvasIsSupported || (_isIE() && Number(_isIE()) <= 9)) {

		$.post(options.templatesDirectory+'canvaserror.php', function(html) {
			$elem.append($.parseHTML(html)).fadeIn(300);

			/**
		     * Gets fired as soon as a template has been loaded.
		     *
		     * @event FancyProductDesigner#templateLoad
		     * @param {Event} event
		     * @param {string} URL - The URL of the loaded template.
		     */
			$elem.trigger('templateLoad', [this.url]);
		});

		$initText.remove();

		/**
	     * Gets fired when the browser does not support HTML5 canvas.
	     *
	     * @event FancyProductDesigner#canvasFail
	     * @param {Event} event
	     */
		$elem.trigger('canvasFail');

		return false;
	}

	//execute this because of a ff issue with localstorage
	try {
		window.localStorage.length;
		window.localStorage.setItem('fpd-version', version);
		//window.localStorage.clear();
	}
	catch(error) {
		localStorageAvailable = false;
		//In Safari, the most common cause of this is using "Private Browsing Mode". You are not able to save products in your browser.
	}

	//lowercase all keys in hexNames
	var key,
		keys = Object.keys(options.hexNames),
		n = keys.length,
		newHexNames = {};

	while (n--) {
	  key = keys[n];
	  newHexNames[key.toLowerCase()] = options.hexNames[key];
	}
	options.hexNames = newHexNames;


	//----------------------------------
	// ------- LOAD TEMPLATES ----------
	//----------------------------------


	//load sidebar html
	$.post(options.templatesDirectory+'productdesigner.php',
		options.labels,
		function(html){

			$elem.append($.parseHTML(html));

			$fullLoader = $elem.children('.fpd-full-loader').hide();
			$mainContainer = $elem.children('.fpd-main-container');
			$productStage = $mainContainer.children('.fpd-product-stage').height(options.stageHeight);

			$elementTooltip = $productStage.children('.fpd-element-tooltip').html(options.labels.outOfContainmentAlert);
			$mainContainer.children('.fpd-context-dialog').remove().clone().appendTo($body);
			$contextDialog = $body.children('.fpd-context-dialog').addClass('fpd-hidden');
			$contextLoader =  $contextDialog.find('.fpd-context-loader');
			$colorPicker = $contextDialog.find('.fpd-color-picker');


			$elem.trigger('templateLoad', [this.url]);

			setTimeout(_initBars, 1000);

		}
	);


	//----------------------------------
	// ------- PRIVATE METHODS ---------
	//----------------------------------

	var _initBars = function() {

		//main buttons handler
		$elem.find('[data-context]').on('mouseup touchend', function() {

			var $this = $(this);
			thisClass.callDialogContent($this.data('context'), $this.children('span').text());

		});

		//download image handler
		if(options.imageDownloadable) {

			$elem.find('.fpd-download-image').on('mouseup touchend', function(evt) {
				var a = document.createElement('a');
				if (typeof a.download !== 'undefined') {
				    $elem.find('.fpd-download-anchor').attr('href', thisClass.getProductDataURL()).attr('download', 'Product.png')[0].click();
				}
				else {
					thisClass.createImage(true, true);
				}

			}).css('display', 'block');

		}

		//check if jsPDF is included
		if(options.saveAsPdf && window.jsPDF) {

			$elem.find('.fpd-save-pdf').on('mouseup touchend', function(evt) {
				evt.preventDefault();
				thisClass.deselectElement();

				var orientation = stage.getWidth() > stage.getHeight() ? 'l' : 'p';
				var doc = new jsPDF(orientation, 'mm', [options.width * 0.26, options.stageHeight * 0.26]),
					viewsDataURL = thisClass.getViewsDataURL('jpeg', 'white');

				for(var i=0; i < viewsDataURL.length; ++i) {
					doc.addImage(viewsDataURL[i], 'JPEG', 0, 0);
					if(i < viewsDataURL.length-1) {
						doc.addPage();
					}
				}

				doc.save('Product.pdf');

			}).css('display', 'block');

		}

		//print product handler
		if(options.printable) {

			$elem.find('.fpd-print').on('mouseup touchend', function(evt) {
				evt.preventDefault();
				thisClass.print();
			}).css('display', 'block');

		}

		//allow user to save products in a list
		if(localStorageAvailable && options.allowProductSaving && $elem.attr('id')) {

			$elem.find('.fpd-save-product, .fpd-load-saved-products').css('display', 'block');

			$elem.find('.fpd-save-product').on('mouseup touchend', function(evt) {
				evt.preventDefault();
				thisClass.deselectElement();

				//get key and value
				var product = thisClass.getProduct(false);
					thumbnail = thisClass.getViewsDataURL('png', 'transparent', 0.2)[0];

				//check if there is an existing products array
				var savedProducts = _getSavedProducts();
				if(savedProducts == null) {
					//create new
					savedProducts = new Array();
				}

				savedProducts.push({thumbnail: thumbnail, product: product});
				window.localStorage.setItem($elem.attr('id'), JSON.stringify(savedProducts));

				_addSavedProduct(thumbnail, product);
				thisClass.showMessage(options.labels.productSaved);

			});

			$elem.find('.fpd-load-saved-products').on('mouseup touchend', function(evt) {

				evt.preventDefault();
				thisClass.callDialogContent('saved-products', $(this).text());

			});

			//load all saved products into list
			var savedProducts = _getSavedProducts();
			if(savedProducts != null) {
				for(var i=0; i < savedProducts.length; ++i) {
					var savedProduct = savedProducts[i];
					_addSavedProduct(savedProduct.thumbnail, savedProduct.product);
				}
			}

		}

		//open/close more dropdown
		$elem.find('.fpd-more').on('click', function() {
			$(this).children('.fpd-dropdown-menu').addClass('fpd-do-trans');
		})
		.mouseleave(function() {
			$(this).children('.fpd-dropdown-menu').removeClass('fpd-do-trans');
		});
		$(document).on('touchend', function() {
			$elem.find('.fpd-more').mouseleave();
		});

		//undo/redo
		$elem.find('.fpd-undo, .fpd-redo').click(function() {

			if($(this).hasClass('fpd-undo')) {

				//store old params
				var oldParams = jQuery.extend({}, currentElement.params);
				redos.push({element: currentElement, parameters: oldParams});

				var last = undos.pop();
				if(last !== undefined && last.element !== undefined) {
					thisClass.setElementParameters(last.element, last.parameters);
				}
				undos.pop(); //pop again

			}
			else {

				var last = redos.pop();
				if(last !== undefined && last.element !== undefined) {
					thisClass.setElementParameters(last.element, last.parameters);
				}

			}

			$elem.find('.fpd-redo').toggleClass('fpd-disabled', redos.length == 0);

		});


		//reset product handler
		$elem.find('.fpd-reset-product').click(function(evt) {
			evt.preventDefault();
			thisClass.loadProduct(currentViews);
		}).show();

		//zoom tools
		$elem.find('.fpd-zoom').hide();
		if(options.maxZoom > 1) {

			$elem.find('.fpd-set-zoom').data('step', options.zoomStep).data('max', options.maxZoom)
			.on('slide', function(evt, ui) {
				thisClass.setZoom(ui.value);
			})

			$elem.find('.fpd-stage-pan').click(function() {
				dragStage = dragStage ? false : true;
				//toggles
				$(this).toggleClass('fpd-checked');
				$productStage.find('canvas').toggleClass('fpd-drag');
			});

			$elem.find('.fpd-zoom > .fpd-btn').click(function() {
				$elem.find('.fpd-set-zoom').slider('value', 1);
				dragStage = false;
				$productStage.find('canvas').removeClass('fpd-drag');
				$elem.find('.fpd-stage-pan').removeClass('fpd-checked');
				$(this).next('.fpd-option-content').stop().toggle(300);
				thisClass.resetZoom();
			}).parent().show();
		}

		_initProductStage();

	};

	var _initProductStage = function() {

		//create fabric stage
		var canvas = $productStage.children('canvas').get(0);
		stage = new fabric.Canvas(canvas, {
			selection: false,
			hoverCursor: 'pointer',
			controlsAboveOverlay: true,
			centeredScaling: true
		});
		stage.setDimensions({width: $elem.width(), height: options.stageHeight});

		//retina-ready
		if( window.devicePixelRatio !== 1 ){

		    var htmlCanvas = stage.getElement();

		    // Scale the canvas up by two for retina
		    htmlCanvas.setAttribute('width', $elem.width() * window.devicePixelRatio);
		    htmlCanvas.setAttribute('height', options.stageHeight * window.devicePixelRatio);

		    // finally set the scale of the context
		    htmlCanvas.getContext('2d').scale(window.devicePixelRatio, window.devicePixelRatio);

		}

		//attach handlers to stage
		stage.on({
			'mouse:down': function(opts) {

				grabStartPointer = stage.getPointer(opts.e);
				mouseDownStage = true;

				if(opts.target == undefined) {
					thisClass.closeDialog();
					thisClass.deselectElement();
				}
				else {
					var pointer = stage.getPointer(opts.e),
						targetCorner = opts.target.findTargetCorner(pointer);

					//remove element
					if(targetCorner == 'tr' && currentElement.params.removable) {
						thisClass.removeElement(currentElement);
					}

					//copy element

					if(targetCorner == 'tl' && currentElement.params.isInitial !== true && !currentElement.params.hasUploadZone) {
						var newParams = jQuery.extend({}, currentElement.params, {autoSelect: true, x: currentElement.params.x + currentElement.width});
						thisClass.addElement(currentElement.type, currentElement.source, 'Copy '+currentElement.title, newParams);
					}

				}
			},
			'mouse:up': function() {

				mouseDownStage = false;

			},
			'mouse:move': function(opts) {

				if(mouseDownStage && dragStage) {

					var currentPointer = stage.getPointer(opts.e),
						x = (viewportPosition.x + currentPointer.x - grabStartPointer.x),
						y = (viewportPosition.y + currentPointer.y - grabStartPointer.y);

					stage.relativePan(new fabric.Point(x, y));

				}

			},
			'text:changed': function(opts) {

				thisClass.setElementParameters(currentElement, {text: opts.target.text});

			},
			'object:moving': function(opts) {
				if((currentElement && currentElement.params.draggable) || options.editorMode) {

					thisClass.setElementParameters(currentElement,
						{
							x: Math.round(opts.target.left / responsiveScale),
							y: Math.round(opts.target.top / responsiveScale)
						}
					);


				}
			},
			'object:scaling': function(opts) {
				if((currentElement && currentElement.params.resizable) || options.editorMode) {

					thisClass.setElementParameters(currentElement,
						{
							scale: Number(opts.target.scaleX / responsiveScale).toFixed(2)
						}
					);

				}
			},
			'object:rotating': function(opts) {
				if((currentElement && currentElement.params.rotatable) || options.editorMode) {

					//reset origin because of a bug when origin-x is left
					currentElement.set({originX: currentElement.params.originX, originY: currentElement.params.originY});

					thisClass.setElementParameters(currentElement,
						{
							degree: Math.round(opts.target.angle)
						}
					);

				}
			},
			'object:selected': function(opts) {

				thisClass.deselectElement(false);

				//dont select anything when in dragging mode
				if(dragStage) {
					thisClass.deselectElement();
					return false;
				}

				currentElement = opts.target;
				var elemParams = currentElement.params;

				if(!$contextDialog.hasClass('fpd-fixed')) {
					//position context dialog next to the selected element
					//right from selected element
					var dialogBoxLeftPosition = currentElement.getLeft() + (currentElement.originX === 'left' ? currentElement.getWidth() : currentElement.getWidth() * 0.5) + 40;
					if(currentElement.getLeft() > $elem.width() * 0.5) {
						//left from selected element
						dialogBoxLeftPosition = currentElement.getLeft() - currentElement.getWidth() * 0.5 - $contextDialog.width() - 40;
					}
					dialogBoxLeftPosition = dialogBoxLeftPosition + $mainContainer.offset().left;
					//always inside the doc
					dialogBoxLeftPosition = dialogBoxLeftPosition < 0 ? 0 : dialogBoxLeftPosition;
					dialogBoxLeftPosition = dialogBoxLeftPosition - $contextDialog.width() > $window.width() ? dialogBoxLeftPosition - $contextDialog.width() : dialogBoxLeftPosition;
					$contextDialog.css({
						left: dialogBoxLeftPosition
					});
				}

				//open adds if object is upload zone
				if(elemParams.uploadZone && !options.editorMode) {
					currentElement.set('borderColor', 'transparent');
					var customAdds = $.extend({}, viewOptions.customAdds, elemParams.customAdds ? elemParams.customAdds : {});
					var opts = {};
					opts.customAdds = customAdds;
					_updateInterface(opts);
					currentUploadZone = currentElement.title;
					thisClass.callDialogContent('adds', $elem.find('[data-context="adds"] span').text(), null, true);
					return false;
				}

				currentUploadZone = null;

				currentElement.set({
					borderColor: options.selectedColor,
					cornerColor: 'transparent',
					cornerSize: 20,
					rotatingPointOffset: 0,
					padding: currentElement.type == 'text' || currentElement.type == 'i-text' ? options.paddingControl : 0
				});

				thisClass.callDialogContent('edit', options.labels.editElement, null, false);

				//toggle colorpicker

				if(((Array.isArray(elemParams.colors) && _elementIsColorizable(currentElement) != false)) || currentElement.type == 'path-group') {

					//svg
					if(currentElement.type == 'path-group') {

						for(var i=0; i<currentElement.paths.length; ++i) {
							var path = currentElement.paths[i],
								color = tinycolor(path.fill);

							$colorPicker.append('<input type="text" value="'+color.toHexString()+'" />');
						}

						$colorPicker.addClass('fpd-colorpicker-group').find('input').spectrum({
							preferredFormat: "hex",
							showInput: true,
							change: function(color) {
								var pathIndex = $colorPicker.find('input').index(this);
								var svgColors = [];
								for(var i=0; i<currentElement.paths.length; ++i) {
									var path = currentElement.paths[i],
										c = tinycolor(path.fill);
									svgColors.push(c.toHexString());
								}
								svgColors[pathIndex] = color.toHexString();
								thisClass.setElementParameters(currentElement, {currentColor: svgColors});
							}
						});

						_updateSpectrum();

					}
					else {

						//color palette
						if(elemParams.colors.length > 1) {

							$colorPicker.html('<div class="fpd-color-palette fpd-grid"></div>');

							for(var i=0; i<elemParams.colors.length; ++i) {

								var color = elemParams.colors[i];
									colorName = options.hexNames[color.replace('#', '')];

								colorName = colorName ? colorName : color;
								$colorPicker.children('.fpd-grid').append('<div class="fpd-item fpd-tooltip" title="'+colorName+'" style="background-color: '+color+';"></div>')
								.children('.fpd-item:last').click(function() {
									var color = tinycolor($(this).css('backgroundColor'));
									thisClass.setElementParameters(currentElement, {currentColor: color.toHexString()});
								});

							}

							_updateTooltip();

						}
						//colorwheel
						else {

							$colorPicker.append('<input type="text" value="'+(elemParams.currentColor ? elemParams.currentColor : elemParams.colors[0])+'" />');

							$colorPicker.find('input').spectrum("destroy").spectrum({
								preferredFormat: "hex",
								showInput: true,
								change: function(color) {
									thisClass.setElementParameters(currentElement, {currentColor: color.toHexString()});
								}
							});

							_updateSpectrum();
						}
					}

					_toggleOptionField($colorPicker, true);
					_toggleOptionField($contextDialog.find('.fpd-opacity-slider'), true);
				}


				//text options
				if(currentElement.type == "i-text"  || currentElement.type == 'curvedText') {

					_toggleOptionField($contextDialog.find('.fpd-patterns'), elemParams.patternable && options.patterns.length);
					_toggleOptionField($contextDialog.find('.fpd-change-text'), elemParams.editable);
					_toggleOptionField($contextDialog.find('.fpd-fonts-dropdown'), elemParams.editable && options.fonts && options.fonts.length > 0);
					_toggleOptionField($contextDialog.find('.fpd-line-height-slider'), elemParams.editable);
					_toggleOptionField($contextDialog.find('.fpd-text-align-left'), elemParams.editable);
					_toggleOptionField($contextDialog.find('.fpd-text-style-bold'), elemParams.editable);


					if(elemParams.curvable) {

						_toggleOptionField($contextDialog.find('.fpd-curved-text-switcher').toggleClass('fpd-checked', elemParams.curved), true);

						if(elemParams.curved) {
							_toggleOptionField($contextDialog.find('.fpd-curved-text-radius-slider'), true);
							_toggleOptionField($contextDialog.find('.fpd-curved-text-spacing-slider'), true);
							_toggleOptionField($contextDialog.find('.fpd-curved-text-reverse-switcher'), true);
							$contextDialog.find('.fpd-curved-text-options:gt(0)').toggleClass('fpd-hidden', !$contextDialog.find('.fpd-curved-text-switcher').hasClass('fpd-checked'));
						}


					}

				}
				else {
					if(elemParams.filters && elemParams.filters.length > 0 && currentElement.type == 'image') {

						//show filter container
						$contextDialog.find('.fpd-filter-options').removeClass('fpd-hidden')
						//hide filter options
						.find('.fpd-item:gt(0)').addClass('fpd-hidden');

						//show available filter options
						for(var i=0; i<elemParams.filters.length; ++i) {
							$contextDialog.find('.fpd-filter-options')
							.find('.fpd-filter-'+elemParams.filters[i]).removeClass('fpd-hidden');
						}

					}

				}

				//TRANSFORMS
				_toggleOptionField($contextDialog.find('.fpd-angle-slider'), elemParams.rotatable);
				_toggleOptionField($contextDialog.find('.fpd-scale-slider'), elemParams.resizable);

				//HELPERS
				$contextDialog.find('.fpd-moveLayer-options').toggleClass('fpd-hidden', !elemParams.zChangeable);
				$contextDialog.find('.fpd-alignment-options').toggleClass('fpd-hidden', !elemParams.draggable);
				$contextDialog.find('.fpd-flip-options').toggleClass('fpd-hidden', !elemParams.resizable);
				$contextDialog.find('.fpd-helper-btns').removeClass('fpd-hidden');


				//check for a boundingbox
				if(elemParams.boundingBox && !options.editorMode) {

					var bbCoords = thisClass.getBoundingBoxCoords(currentElement);
					if(bbCoords) {
						currentBoundingObject = new fabric.Rect({
							left: bbCoords.left,
							top: bbCoords.top,
							width: bbCoords.width,
							height: bbCoords.height,
							stroke: options.boundingBoxColor,
							strokeWidth: 1,
							fill: false,
							selectable: false,
							evented: false,
							originX: 'left',
							originY: 'top',
							name: "bounding-box",
							params: {
								x: bbCoords.left,
								y: bbCoords.top,
								scale: 1
							}
						});

						stage.add(currentBoundingObject);
						currentBoundingObject.bringToFront();
					}
				}

				_updateEditUI();
				_refreshDesignerSize();
				_positionElements(responsiveScale);
				_checkContainment(currentElement);
				_updateEditorBox(currentElement);
				_resetUndoRedo();

				/**
			     * Gets fired as soon as an element is selected.
			     *
			     * @event FancyProductDesigner#elementSelect
			     * @param {Event} event
			     * @param {fabric.Object} currentElement - The current selected element.
			     */

				$elem.trigger('elementSelect', [currentElement]);
			}
		});


		_initContextDialog();

	};

	var _initContextDialog = function() {

		//make dialog draggable

		$contextDialog.addClass('fpd-'+options.dialogBoxPositioning);
		if(options.dialogBoxPositioning == 'dynamic') {

			$contextDialog
			.draggable({
				handle: $contextDialog.find('.fpd-dialog-head'),
				drag: function(evt, ui) {
					if(ui.offset.top <= 0) {
						ui.position.top = 0;
					}
					$colorPicker.find('input').spectrum('reflow');
				}
			})
			.resizable({
				resize: function() {
					_setDynamicColumns();
				},
				stop: function() {
					_refreshLazyLoad(false);
				}
			});

		}
		else if(options.dialogBoxPositioning == 'left' || options.dialogBoxPositioning == 'right') {
			$contextDialog.addClass('fpd-fixed');
		}

		//deselect element when closing dialog
		$contextDialog.find('.fpd-dialog-head .fpd-close-dialog').click(function() {

			thisClass.deselectElement();
			thisClass.closeDialog();

		});

		$contextDialog.find('.fpd-content-back').click(function() {

			$(this).removeClass('fpd-show');
			$contextDialog.find('.fpd-content-sub.fpd-show').removeClass('fpd-show');
			_setDialogTitle($contextDialog.find('.fpd-content-back').data('parentTitle'));

		});

		//select associated element on stage when choosing one from the layers list
		$contextDialog.on('click', '.fpd-content-layers .fpd-list-row', function() {

			if($(this).hasClass('fpd-locked')) {
				return false;
			}

			var objects = stage.getObjects();
			for(var i=0; i < objects.length; ++i) {
				if(objects[i].id == this.id) {
					stage.setActiveObject(objects[i]);
					break;
				}
			}

		});

		//remove element
		$contextDialog.on('click', '.fpd-content-layers .fpd-lock-element',function(evt) {

			evt.stopPropagation();

			var $this = $(this),
				element = _getElementByID($this.parents('.fpd-list-row').attr('id'));

			//lock element
			if(element.evented) {
				element.evented = false;
				$this.children('i').removeClass('fpd-icon-unlocked').addClass('fpd-icon-locked');
				$this.parents('.fpd-list-row').addClass('fpd-locked')
				.children('div:lt(2)').css('opacity', 0.2).css('pointer-events', 'none');
			}
			//unlock
			else {
				element.evented = true;
				$this.children('i').removeClass('fpd-icon-locked').addClass('fpd-icon-unlocked');
				$this.parents('.fpd-list-row').removeClass('fpd-locked')
				.children('div:lt(2)').css('opacity', 1).css('pointer-events', 'visible');
			}

			$this.tooltipster('content', element.evented ? options.labels.lock : options.labels.unlock);
			$this.parents('.fpd-list:first').sortable( 'refresh' );

		});

		//remove element
		$contextDialog.on('click', '.fpd-content-layers .fpd-remove-element',function(evt) {

			evt.stopPropagation();
			thisClass.removeElement($(this).parents('.fpd-list-row').children('.fpd-cell-1').text());

		});

		//sortable layers list
		var draggedElement;
		$contextDialog.find( ".fpd-content-layers .fpd-list" ).sortable({
			handle: '.fpd-icon-reorder',
			placeholder: 'fpd-sortable-placeholder',
			scroll: true,
			axis: 'y',
			items: '.fpd-list-row:not(.fpd-locked)',
			start: function(evt, ui) {

				tempLayerListItemTop = ui.originalPosition.top;
				ui.placeholder.addClass('fpd-list-row').html('<div></div>');

				draggedElement = null;
				var objects = stage.getObjects();
				for(var i=0; i < objects.length; ++i) {
					if(objects[i].id == ui.item.attr('id')) {
						draggedElement = objects[i];
						break;
					}
				}
			},
			change: function(evt, ui) {

				//get next element in list, but not if its the sortable helper
				if(ui.position.top < tempLayerListItemTop) {
					//use when decreasing z
					var indexElement = ui.placeholder.nextAll('.fpd-list-row:not(.ui-sortable-helper):first');
				}
				else {
					//use when increasing z
					var indexElement = ui.placeholder.prevAll('.fpd-list-row:not(.ui-sortable-helper):first');
				}

				tempLayerListItemTop = ui.position.top;

				var newZ = 0;
				//last position, use length of objects in stage
				if(indexElement.size() === 0) {
					newZ = stage.getObjects().length-1;
				}
				else {
					//get index of object of all objects
					newZ = stage.getObjects().indexOf(_getElementByID(indexElement.attr('id')));
					//last position, decrease by one
					if(indexElement.is(ui.placeholder.nextAll('.fpd-list-row:not(.ui-sortable-helper):last'))) {
						newZ--;
					}

				}
				//z always >= 0
				newZ = newZ < 0 ? 0 : newZ;
				if(draggedElement) {
					draggedElement.moveTo(newZ);
				}


			}
		});

		//trigger click on input upload
		var $imageInput = $contextDialog.find('.fpd-input-image');
		$contextDialog.find('.fpd-add-image').click(function(evt) {

			evt.preventDefault();
			$imageInput.click();

		});

		//listen when input upload changes
		$contextDialog.find('.fpd-upload-form').on('change', function(evt) {

			if(window.FileReader) {

				var reader = new FileReader();
				var designTitle = evt.target.files[0].name;
		    	reader.readAsDataURL(evt.target.files[0]);

		    	reader.onload = function (evt) {
					thisClass.addCustomImage(evt.target.result, designTitle);
				}

			}

			$imageInput.val('');

		});

		//add custom text
		$contextDialog.find('.fpd-add-text').click(function() {

			var $inputText = $(this).children('.fpd-input-text');

			$inputText.addClass('fpd-show-up').children('input').focus();

			setTimeout(function() {
				$inputText.children('input').focus();
			}, 100);

		});

		$contextDialog.find('.fpd-input-text > .fpd-btn').click(function(evt) {

        	evt.stopPropagation();

			var $input = $(this).prev('input:first'),
				text = $input.val();

			if(text && text.length > 0) {

				var textParams = $.extend({}, viewOptions.customTextParameters, {isCustom: true});
				thisClass.addElement(
					'text',
					text,
					text,
					textParams,
					currentViewIndex
				);
			}

			$contextDialog.find('.fpd-add-text .fpd-input-text').removeClass('fpd-show-up');
			$input.val('');

		});

		$contextDialog.find('.fpd-input-text > input').keyup(function(evt){

		    if(evt.keyCode == 13) {
		    	$contextDialog.find('.fpd-input-text > .fpd-btn').click();
		    }

		});

		//check if user can add photos from facebook
		if(options.facebookAppId && options.facebookAppId.length > 0) {

			var $fbPhotoGrid = $contextDialog.find('.fpd-add-facebook-photo-wrapper .fpd-grid');

			$contextDialog.find('.fpd-add-facebook-photo').click(function() {
				thisClass.callDialogContent('adds', $(this).children('span').text(), 'facebook');
			});

			var $fbAlbumsSelect = $contextDialog.find('.fpd-fb-user-albums').change(function() {

				$contextLoader.show();

				var albumId = $(this).children('option:selected').val();

				$fbPhotoGrid.children('.fpd-item').remove();

				//get photos from fb album
				FB.api('/'+albumId, function(response) {

					var albumCount = response.count;

					FB.api('/'+albumId+'?fields=photos.limit('+albumCount+')', function(response) {

						if(!response.error) {
							var photos = response.photos.data;

							for(var i=0; i < photos.length; ++i) {
								var photo = photos[i],
									photoImg = photo.images[photo.images.length-1] ? photo.images[photo.images.length-1].source : photo.source;

								var $lastItem = $fbPhotoGrid.append('<div class="fpd-item" data-picture="'+photo.source+'" title="'+photo.id+'"><picture></picture></div>')
								.children('.fpd-item:last').click(function(evt) {

									evt.preventDefault();
									$fullLoader.show();

									var $this = $(this);

									$.post(options.phpDirectory + 'get_image_data_url.php', { url: $this.data('picture') }, function(data) {

										if(data && data.error == undefined) {

											var picture = new Image();
											picture.src = data.data_url;
											picture.onload = function() {

												options.customImageParameters.scale = thisClass.getScalingByDimesions(
													this.width,
													this.height,
													options.customImageParameters.resizeToW,
													options.customImageParameters.resizeToH
												);

												thisClass.addCustomImage( this.src, $this.attr('title') );
											};

										}
										else {
											alert(data.error);
										}

									}, 'json')
									.fail(function(evt) {

										$fullLoader.hide();
										alert(evt.statusText);

									});

								});

								_loadImage($lastItem.children('picture'), photoImg);
								_createScrollbar($fbPhotoGrid.parent());

							}
						}

						$contextLoader.hide();

					});
				});
			});

			$.ajaxSetup({ cache: true });
			$.getScript('//connect.facebook.com/en_US/sdk.js', function(){

				//init facebook
				FB.init({
					appId: options.facebookAppId,
					status: true,
					cookie: true,
					xfbml: true,
					version: 'v2.0'
				});

				FB.Event.subscribe('auth.statusChange', function(response) {

					if (response.status === 'connected') {
						// the user is logged in and has authenticated your app

						$contextLoader.show();

						FB.api('/me/albums', function(response) {

							var albums = response.data;
							//add all albums to select
							for(var i=0; i < albums.length; ++i) {
								var album = albums[i];
								$fbAlbumsSelect.append('<option value="'+album.id+'">'+album.name+'</option>').nextAll('.select2').show();
							}

							$contextLoader.hide();
						});

					}
					else {
						// the user isn't logged into Facebook.
						$fbPhotoGrid.children('.fpd-item').remove();
						$fbAlbumsSelect.empty().val('').change().nextAll('.select2').hide();
					}

				});

			});
		}


		//instagram
		if(options.instagramClientId.length) {

			$contextDialog.find('.fpd-add-instagram-photo').click(function() {
				$contextDialog.find('.fpd-insta-feed').click();
				thisClass.callDialogContent('adds', $(this).children('span').text(), 'instagram');
			});

			$contextDialog.find('.fpd-insta-feed, .fpd-insta-recent-images').click(function(evt) {

				evt.preventDefault();
				var $this = $(this),
					endpoint = $this.hasClass('fpd-insta-feed') ? 'feed' : 'recent';

				//check if access token is stored in browser
				instaAccessToken = window.localStorage.getItem('fpd_instagram_access_token');
				if(!localStorageAvailable || instaAccessToken == null) {
					_authenticateInstagram(function() {
						_loadInstaImages(endpoint);
					});
				}
				//load images by requested endpoint
				else {
					_loadInstaImages(endpoint);
				}
			});

		}

		//load all designs
		if($designs.size() > 0) {

			$contextDialog.find('.fpd-add-design').click(function() {
				thisClass.callDialogContent('adds', $(this).children('span').text(), 'designs');
			});

			//check if categories are used
			if($designs.children('.fpd-category').length > 1) {

				//categories are found
				//create design dropdown
				$designCategories = $contextDialog.find('.fpd-add-design-wrapper .fpd-content-head').append('<select class="fpd-design-categories" tabindex="1"></select>')
				.children('.fpd-design-categories').change(function() {

					//get designs from selected category
					var designsInCat = designCategories[this.value];

					//empty list
					$contextDialog.find('.fpd-add-design-wrapper .fpd-grid > .fpd-item').remove();

					//add designs from category to list
					for(var i=0; i < designsInCat.length; ++i) {
						_addGridDesign(designsInCat[i]);
					}

					_refreshLazyLoad(false);

				});

				//browse through all categories
				$designs.children('.fpd-category').each(function(i, cat) {

					var $cat = $(cat),
						categoryParams = $cat.data('parameters') ? $cat.data('parameters') : {};

					$cat.children('img').each(function(j, design) {
						var $design = $(design);
						thisClass.addDesign(
							$design.data('src') == undefined ? $design.attr('src') : $design.data('src'),
							$design.attr('title'),
							$.extend({}, categoryParams, $design.data('parameters')),
							cat.title,
							$design.data('thumbnail')
						);
					});

				});

			}
			else {

				$contextDialog.find('.fpd-add-design-wrapper').addClass('fpd-no-categories');

				//append designs to list
				var $designImgs = $designs.find('img');
				for(var i=0; i < $designImgs.length; ++i) {
					var $design = $($designImgs[i]);
					thisClass.addDesign(
						$design.data('src') == undefined ? $design.attr('src') : $design.data('src'),
						$design.attr('title'),
						$design.data('parameters'),
						false,
						$design.data('thumbnail')
					);
				}
			}

			$designs.remove();
		}

		//************ EDIT FORM ****************

		//patterns
		if(options.patterns && options.patterns.length > 0) {

			for(var i=0; i < options.patterns.length; ++i) {
				var patternUrl = options.patterns[i];
				$contextDialog.find('.fpd-patterns > .fpd-grid').append('<div class="fpd-item" data-pattern="'+patternUrl+'"><picture style="background-image: url('+patternUrl+');"></picture></div>')
				.children(':last').click(function() {

					thisClass.setElementParameters(currentElement, {
							pattern: $(this).data('pattern')
						}
					);

				});
			}

		}

		//opacity
		$contextDialog.find('.fpd-opacity-slider').on('slide', function(evt, ui) {

			thisClass.setElementParameters(currentElement, {opacity: ui.value });

		});

		//change text
		$contextDialog.find('.fpd-change-text').keyup(function() {

			thisClass.setElementParameters(currentElement, {text: this.value});

		});

		//change filter
		var filterCounter = 0,
			filterImage = null,
			availableFilters = ['no', 'grayscale', 'sepia', 'sepia2'];

		function _addFilterItem(type) {

			var fabricFilter = _getFabircFilter(type);
			filterImage.filters = [];
			if(fabricFilter != null) {
				filterImage.filters.push(fabricFilter);
			}

			//apply filter
			filterImage.applyFilters(function() {

				filterCounter++;
				$contextDialog.find('.fpd-filter-'+type).removeClass('fpd-hidden')
				.children('picture').css('background-image', 'url('+filterImage.toDataURL()+')');

				//load next filter
				if(filterCounter != availableFilters.length) {
					_addFilterItem(availableFilters[filterCounter]);
				}
				//no more filters
				else {
					stage.remove(filterImage);
				}

			});
		};

		//create clone of image
		fabric.Image.fromURL(fancyProductDesignerFilterImg, function(img) {

			filterImage = img;
			stage.add(filterImage.set({ top: -10000, left: -10000}));
			//add first filter
			_addFilterItem(availableFilters[0]);

		});


		$contextDialog.find('.fpd-filter-options .fpd-item').click(function() {

			thisClass.setElementParameters(currentElement, {filter: $(this).data('filter')});

		});

		if(options.fonts.length > 0) {

			//change font family when dropdown changes
			$contextDialog.find('.fpd-fonts-dropdown').change(function() {

				thisClass.setElementParameters(currentElement, {font: this.value});

			});

			options.fonts.sort();
			for(var i=0; i < options.fonts.length; ++i) {
				var fontName = options.fonts[i].indexOf(':') == -1 ? options.fonts[i] : options.fonts[i].substring(0, options.fonts[i].indexOf(':'));
				if($contextDialog.find('.fpd-fonts-dropdown').children('option[value="'+fontName+'"]').size() == 0) {
					$contextDialog.find('.fpd-fonts-dropdown').append('<option value="'+fontName+'" style="font-family: '+fontName+';">'+fontName+'</option>');
				}
			}

			//set font family in font dropdown for every option
			$contextDialog.find('.fpd-fonts-dropdown').on('select2:open', function() {

				$(this).children('option').each(function(i, item) {
					$('.select2-results').find('li').eq(i).css('font-family', item.value);
				});

			});

		}

		//change line-height
		$contextDialog.find('.fpd-line-height-slider').on('slide', function(evt, ui) {

			thisClass.setElementParameters(currentElement, {lineHeight: ui.value });

		});

		//change alignment
		$contextDialog.find('.fpd-set-alignment .fpd-btn').click(function(evt) {

			evt.preventDefault();
			var $this = $(this);

			if($this.hasClass('fpd-text-align-left')) {
				thisClass.setElementParameters(currentElement, {textAlign: 'left'});
			}
			else if($this.hasClass('fpd-text-align-center')) {
				thisClass.setElementParameters(currentElement, {textAlign: 'center'});
			}
			else if($this.hasClass('fpd-text-align-right')) {
				thisClass.setElementParameters(currentElement, {textAlign: 'right'});
			}

			if(currentElement.type == 'curvedText') {
				currentElement.setFill(currentElement.fill);
			}

			stage.renderAll();

		});

		//change style
		$contextDialog.find('.fpd-set-style .fpd-btn').click(function(evt) {

			evt.preventDefault();
			var $this = $(this);

			if($this.hasClass('fpd-text-style-bold')) {
				thisClass.setElementParameters(currentElement, {fontWeight: currentElement.getFontWeight() == 'bold' ? 'normal' : 'bold'});
			}
			else if($this.hasClass('fpd-text-style-italic')) {
				thisClass.setElementParameters(currentElement, {fontStyle: currentElement.getFontStyle() == 'italic' ? 'normal' : 'italic'});
			}
			else if($this.hasClass('fpd-text-style-underline')) {
				thisClass.setElementParameters(currentElement, {textDecoration: currentElement.getTextDecoration() == 'underline' ? 'normal' : 'underline'});
			}

			//call setfill again, otherwise font styles are not attached to curved text
			if(currentElement.type == 'curvedText') {
				currentElement.setFill(currentElement.fill);
			}

			stage.renderAll();

		});

		//change angle
		$contextDialog.find('.fpd-angle-slider').on('slide', function(evt, ui) {

			thisClass.setElementParameters(currentElement, {degree: ui.value });

		});

		//change angle
		$contextDialog.find('.fpd-scale-slider').on('slide', function(evt, ui) {

			thisClass.setElementParameters(currentElement, {scale: ui.value });

		});

		//move layer
		$contextDialog.find('.fpd-move-up, .fpd-move-down').click(function(evt) {

			var $this = $(this),
				$list = $contextDialog.find( ".fpd-content-layers .fpd-list" ),
				$listItem = $list.children('[id="'+currentElement.id+'"]');

			if($this.hasClass('fpd-move-down')) {

				if($listItem.prev('div').size() > 0) {
					$listItem.insertBefore($listItem.prev('div:first'));
					var indexElement = $listItem.nextAll('.fpd-list-row:not(.ui-sortable-helper):first'),
						newZ = stage.getObjects().indexOf(_getElementByID(indexElement.attr('id')));

					currentElement.moveTo(newZ);
				}

			}
			else {

				if($listItem.next('div').size() > 0) {
					$listItem.insertAfter($listItem.next('div:first'));
					var indexElement = $listItem.prevAll('.fpd-list-row:not(.ui-sortable-helper):first'),
						newZ = stage.getObjects().indexOf(_getElementByID(indexElement.attr('id')));

					currentElement.moveTo(newZ);
				}

			}

		});

		//center element
		$contextDialog.find('.fpd-center-horizontal, .fpd-center-vertical').click(function(evt) {

			var $this = $(this);
			_centerObject(currentElement, $this.hasClass('fpd-center-horizontal'), $this.hasClass('fpd-center-vertical'), currentBoundingObject ? thisClass.getBoundingBoxCoords(currentElement) : false);

		});

		//toggle normal text/curved text
		$contextDialog.find('.fpd-curved-text-switcher').click(function() {

			var z = _getZIndex(currentElement),
				defaultText = currentElement.getText(),
				params = currentElement.params;

			params.z = z;
			params.curved = currentElement.type == 'i-text';
			params.textAlign = 'center';

			function _onTextModeChanged(evt, textElement) {
				stage.setActiveObject(textElement);
				$elem.off('elementAdded', _onTextModeChanged);
			};
			$elem.on('elementAdded', _onTextModeChanged);

			thisClass.removeElement(currentElement);
			thisClass.addElement('text', defaultText, defaultText, params);

		});

		//set radius for curved text
		$contextDialog.find('.fpd-curved-text-radius-slider').on('slide', function(evt, ui) {

			if(currentElement && currentElement.params.curved) {
				thisClass.setElementParameters(currentElement, {curveRadius: ui.value });
			}

		});

		//set spacing for curved text
		$contextDialog.find('.fpd-curved-text-spacing-slider').on('slide', function(evt, ui) {

			if(currentElement && currentElement.params.curved) {
				thisClass.setElementParameters(currentElement, {curveSpacing: ui.value });
			}

		});

		//toggle reverese for curved text
		$contextDialog.find('.fpd-curved-text-reverse-switcher').click(function() {

			if(currentElement && currentElement.params.curved) {
				$(this).toggleClass('fpd-checked');
				thisClass.setElementParameters(currentElement, {curveReverse: $(this).hasClass('fpd-checked') });
			}

		});

		//set flipX/flipY
		$contextDialog.find('.fpd-flip-horizontal, .fpd-flip-vertical').click(function() {

			if($(this).hasClass('fpd-flip-horizontal')) {
				thisClass.setElementParameters(currentElement, {flipX: !currentElement.flipX });
			}
			else {
				thisClass.setElementParameters(currentElement, {flipY: !currentElement.flipY });
			}

		});

		//reset element to his origin
		$contextDialog.find('.fpd-reset-element').click(function() {

			if(currentElement) {

				var originParams = currentElement.originParams,
					tempElement = currentElement;

				var resetParams = {
					x: originParams.x,
					y: originParams.y,
					currentColor: originParams.currentColor,
					degree: originParams.degree,
					opacity: originParams.opacity,
					scale: originParams.scale
				}

				if(originParams.text !== undefined) {
					resetParams.text = originParams.text;
					resetParams.font = originParams.font;
					resetParams.lineHeight = originParams.lineHeight;
					resetParams.textAlign = originParams.textAlign;
					resetParams.fontWeight = originParams.fontWeight;
					resetParams.fontStyle = originParams.fontStyle;
					resetParams.curveSpacing = originParams.curveSpacing;
					resetParams.curveRadius = originParams.curveRadius;
				}

				thisClass.deselectElement();
				thisClass.setElementParameters(tempElement, resetParams);

				if(originParams.autoCenter) {
					_doCentering(tempElement);
				}

				stage.setActiveObject(tempElement);

				if(originParams.colors && originParams.currentColor != originParams.colors[0]) {
					//if svg, return color array
					var colors = tempElement.type == 'path-group' ? originParams.colors : originParams.colors[0];
					thisClass.setElementParameters(tempElement, {currentColor: colors});
					stage.renderAll();
			    }

			    _resetUndoRedo();
			    $(this).tooltipster('hide');

			}

		});

		_setup();

	};

	var _setup = function() {

		//check if categories are used
		if($products.is('.fpd-category') && $products.filter('.fpd-category').size() > 1) {

			//categories are found
			$productCategories = $contextDialog.find('.fpd-content-products .fpd-content-head').append('<select class="fpd-product-categories"></select>')
			.children('.fpd-product-categories').change(function() {

				currentProductIndex = -1;

				//get products from selected category
				var productsInCat = productCategories[this.value];

				//empty list
				$contextDialog.find('.fpd-content-products .fpd-grid > .fpd-item').remove();

				//add products from category to grid
				for(var i=0; i < productsInCat.length; ++i) {
					_addGridProduct(productsInCat[i]);
				}

				_refreshLazyLoad(false);

			});

			//loop through all categories
			$products.each(function(i, cat) {
				var $cat = $(cat);
				_createProductsFromHTML($cat.children('.fpd-product'), $cat.attr('title'));
			});

		}
		else {

			//no categories are used
			$contextDialog.find('.fpd-content-products').addClass('fpd-no-categories');
			$products = $products.filter('.fpd-category').size() === 0 ? $products : $products.children('.fpd-product');
			_createProductsFromHTML($products, false);

		}

		//create UI sliders
		$body.find('.fpd-slider').each(function(i, slider) {

			var $slider = $(slider);
			$slider.slider({
				range: "min",
				value: $slider.data('value'),
				min: $slider.data('min'),
				max: $slider.data('max'),
				step: $slider.data('step')
			});

			//add color classes
			$slider.find('.ui-slider-range, .ui-slider-handle')
			.addClass('fpd-secondary-bg-color fpd-secondary-text-color');

		});

		//create UI selectbox
		$contextDialog.find('select').select2({
			width: '100%',
			dir: $body.css('direction')
		});

		//tabs
		$contextDialog.find('.fpd-tabs > .fpd-btn').click(function() {

			var $this = $(this);
			$this.parent().children('.fpd-btn').removeClass('fpd-checked');
			$this.addClass('fpd-checked');

		});

		//switchers
		$contextDialog.find('.fpd-switch-container').click(function() {

			var $this = $(this);

			if($this.hasClass('fpd-curved-text-switcher')) {

				$contextDialog.find('.fpd-curved-text-options:gt(0)').toggleClass('fpd-hidden', !$this.hasClass('fpd-checked'));

			}
		});

		//save the last modification when using a draggable option
		$body.mousedown(function() {
			startIndexUndo = undos.length;
		})
		.mouseup(function() {

			//timeout needed to store undos later after modification of an object
			setTimeout(function() {

				endIndexUndo = undos.length;
				//dragging was used
				if(startIndexUndo != endIndexUndo) {
					undos.splice(startIndexUndo+1, undos.length-1)
				}

				//toggle undo button
				$elem.find('.fpd-undo').toggleClass('fpd-disabled', undos.length == 0 || !currentElement);

			}, 5);

		});

		//prevent document scrolling when in dialog content
		$body.on({
		    'mousewheel': function(evt) {

		        if ($(evt.target).parents('.fpd-dialog-content').size() > 0) {
			    	evt.preventDefault();
				    evt.stopPropagation();
			    }

		    }
		});

		_createScrollbar($contextDialog.find('.fpd-content-layers, .fpd-content-edit, .fpd-content-saved-products, .fpd-content-products .fpd-content-main'));


		//load editor box if requested
		if(options.editorMode) {
			$.post(
				options.templatesDirectory+'editorbox.php',
				function(html){
					if(typeof options.editorMode === 'string') {
						$editorBox = $(options.editorMode).append($.parseHTML(html)).children('.fpd-editor-box');
					}
					else {
						$elem.after($.parseHTML(html));
						$editorBox = $elem.next('.fpd-editor-box');
					}

				}
			)
		}

		$initText.remove();
		$elem.addClass('fpd-show-up');

		//window resize handler
		$(window).resize(_refreshDesignerSize);
		_refreshDesignerSize();

		/**
	     * Gets fired as soon as the product designer is ready to receive API calls.
	     *
	     * @event FancyProductDesigner#ready
	     * @param {Event} event
	     */

		$elem.trigger('ready');

		//load first product
		if($contextDialog.find('.fpd-content-products .fpd-item:first').size() > 0 && !stageCleared) {
			$contextDialog.find('.fpd-content-products .fpd-item:first').click();
		}
		else {
			$fullLoader.hide();
		}

	};

	//creates all products from HTML markup
	var _createProductsFromHTML = function($products, category) {

		var views = [];
		for(var i=0; i < $products.length; ++i) {
			//get other views
			views = $($products.get(i)).children('.fpd-product');
			//get first view
			views.splice(0,0,$products.get(i));

			var viewsArr = [];
			views.each(function(i, view) {
				var $view = $(view);
				var viewObj = {
						title: view.title,
						thumbnail: $view.data('thumbnail'),
						elements: [],
						options: $view.data('options')
					};

				$view.children('img,span').each(function(j, element) {
					var $element = $(element),
						source;

					if($element.is('img')) {
						source = $element.data('src') == undefined ? $element.attr('src') : $element.data('src');
					}
					else {
						source = $element.text()
					}

					var elementObj = {
						type: $element.is('img') ? 'image' : 'text', //type
						source: source, //source
						title: $element.is('img') ? $element.attr('title') : $element.text(),  //title
						parameters: $element.data('parameters') == undefined || $element.data('parameters').length <= 2 ? {} : $element.data('parameters')  //parameters
					};
					elementObj.parameters.isInitial = true;
					viewObj.elements.push(elementObj);
				});
				viewsArr.push(viewObj);
			});

			thisClass.addProduct(viewsArr, category);
		}

	};

	var _createSingleView = function(title, elements) {

		var element = elements[0];
		//check if view contains at least one element
		if(element) {
			var countElements = 0;
			//iterative function when element is added, add next one
			function _onElementAdded(evt, addedElement) {

				countElements++;

				//add all elements of a view
				if(countElements < elements.length) {
					var element = elements[countElements];
					thisClass.addElement( element.type, element.source, element.title, element.parameters, viewsLength-1);
				}
				//all elements are added
				else {
					$elem.off('elementAdded', _onElementAdded);

					/**
				     * Gets fired as soon as a view has been created.
				     *
				     * @event FancyProductDesigner#viewCreate
				     * @param {Event} event
				     * @param {string} title - The view title.
				     */
					$elem.trigger('viewCreate', [elements, title]);
				}

			};
			//listen when element is added
			$elem.on('elementAdded', _onElementAdded);
			//add first element of view
			thisClass.addElement( element.type, element.source, element.title, element.parameters, viewsLength-1);
		}
		//no elements in view, view is created without elements
		else {
			$elem.trigger('viewCreate', [elements, title]);
		}

	};

	//checks if an element is in his containment (bounding box)
	var _checkContainment = function(target) {

		if(currentBoundingObject && !target.params.boundingBoxClipping && !target.params.hasUploadZone) {

			//reset
			var objects = [currentBoundingObject, target];
			for(var i=0; i < objects.length; ++i) {
				objects[i].scaleX = objects[i].params.scale * responsiveScale;
				objects[i].scaleY = objects[i].params.scale * responsiveScale;
		        objects[i].left = objects[i].params.x * responsiveScale;
		        objects[i].top = objects[i].params.y * responsiveScale;
				objects[i].setCoords();
			}

			var targetCoordsTL = target.oCoords.tl,
				isOut = false,
				tempIsOut = target.isOut;

			var isOut = !target.isContainedWithinObject(currentBoundingObject);

			if(isOut) {
				target.borderColor = options.outOfBoundaryColor;
				if(options.tooltips ) {
					$elementTooltip.css({
						right: stage.getWidth() - targetCoordsTL.x - target.getWidth() * 0.5,
						top: targetCoordsTL.y - $elementTooltip.outerHeight() - 20
					}).show();
				}
				target.isOut = true;
			}
			else {
				target.borderColor = options.selectedColor;
				$elementTooltip.hide();
				target.isOut = false;
			}


			if(tempIsOut != target.isOut && tempIsOut != undefined) {
				if(isOut) {

					/**
				     * Gets fired as soon as an element is outside of its bounding box.
				     *
				     * @event FancyProductDesigner#elementOut
				     * @param {Event} event
				     */
					$elem.trigger('elementOut');
				}
				else {

					/**
				     * Gets fired as soon as an element is inside of its bounding box again.
				     *
				     * @event FancyProductDesigner#elementIn
				     * @param {Event} event
				     */
					$elem.trigger('elementIn');
				}
			}
		}

	};

	var _changeColor = function(element, hex, temp) {

		temp = typeof temp === 'undefined' ? false : temp;

		//check if hex color has only 4 digits, if yes, append 3 more
		if(hex.length == 4) {
			hex += hex.substr(1, hex.length);
		}

		//text
		if(element.type == 'i-text'  || element.type == 'curvedText') {
			hex = hex === false ? '#000000' : hex;
			//set color of a text element
			element.setFill(hex);
			stage.renderAll();
			if(temp == false) { element.params.pattern = null; }
			$colorPicker.find('input').spectrum("set", hex);
			_setColorPrice(element, hex);
		}
		//path groups (svg)
		else if(element.type == 'path-group' && typeof hex == 'object') {
			for(var i=0; i<hex.length; ++i) {
				element.paths[i].setFill(hex[i]);
				$colorPicker.find('input').eq(i).spectrum("set", hex[i]);
			}
		}
		//image
		else {

			var colorizable = _elementIsColorizable(element);
			//colorize png or dataurl image
			if(colorizable == 'png' || colorizable == 'dataurl') {

				if(hex == false) {
					element.filters = [];
				}
				else {
					element.filters.push(new fabric.Image.filters.Tint({color: hex}));
					_setColorPrice(element, hex);
				}

				try {
					element.applyFilters(function() {
						stage.renderAll();
						$body.mouseup();
					});
				}
				catch(evt) {
					alert("Image element could not be colorized. Please be sure that the image is hosted under the same domain and protocol, in which you are using the product designer!");
				}

			}
			//colorize svg
			else if(colorizable == 'svg') {
				element.setFill(hex);
			}

			$colorPicker.find('input').spectrum("set", hex);

		}

		if(temp == false) { element.params.currentColor = hex; }

		_checkColorControl(element, hex);

	};

	//sets the price for the element if it has color prices
	var _setColorPrice = function(element, hex) {

		if(element.params.colorPrices && typeof element.params.colors === 'object') {

			if(element.params.currentColorPrice !== undefined) {
				element.params.price -= element.params.currentColorPrice;
				currentPrice -= element.params.currentColorPrice;
			}

			var hexKey = hex.replace('#', '');
			if(element.params.colorPrices.hasOwnProperty(hexKey) || element.params.colorPrices.hasOwnProperty(hexKey.toUpperCase())) {

				var elementColorPrice = element.params.colorPrices[hexKey] === undefined ? element.params.colorPrices[hexKey.toUpperCase()] : element.params.colorPrices[hexKey];

				element.params.currentColorPrice = elementColorPrice;
				element.params.price += element.params.currentColorPrice;
				currentPrice += element.params.currentColorPrice;

			}
			else {
				element.params.currentColorPrice = 0;
			}

			$elem.trigger('priceChange', [element.params.price, currentPrice]);

		}

	};

	//checks if the color of another element is controlled by the current element color
	var _checkColorControl = function(object, color) {

		if(object.colorControlFor) {

			var objects = object.colorControlFor;
			for(var i=0; i < objects.length; ++i) {
				_changeColor(objects[i], color);
			}
		}

	};

	//returns an object with the saved products for the current showing product
	var _getSavedProducts = function() {

		return localStorageAvailable ? JSON.parse(window.localStorage.getItem($elem.attr('id'))) : false;

	};

	//check if key is valid and available
	var _checkStorageKey = function(key) {

		//check if a key is set
		if(key == null) { return -1; }
		//check if key is not empty
		else if(key == "") { return 0; }

		//everything is fine
		return 1;

	};

	var _doCentering = function(object) {

		_centerObject(object, true, true, thisClass.getBoundingBoxCoords(object));
		object.params.autoCenter = false;

	};

	//center object
	var _centerObject = function(object, hCenter, vCenter, boundingBox) {

		var left, top;

		if(hCenter) {

			if(boundingBox) {

				//originX = left
				if(object.originX == 'left') {
					left = boundingBox.left + boundingBox.width * 0.5 - object.width * 0.5;

				}
				//oringX = center
				else {
					left = boundingBox.left + boundingBox.width * 0.5;
				}

			}
			else {

				if(object.originX == 'left') {
					left = options.width * 0.5 - object.width * 0.5;
				}
				else {
					left = options.width * 0.5;
				}

			}

			object.left = left;

		}

		if(vCenter) {
			if(boundingBox) {

				//originX = left
				if(object.originX == 'left') {
					top = boundingBox.top + boundingBox.height * 0.5 - object.width * 0.5;
				}
				//oringX = center
				else {
					top = boundingBox.top + boundingBox.height * 0.5;
				}

			}
			else {

				if(object.originX == 'left') {
					top = options.stageHeight * 0.5 - object.height * 0.5;
				}
				else {
					top = options.stageHeight * 0.5;
				}

			}

			object.top = top;

		}

		_checkContainment(object);
		stage.renderAll();
		object.setCoords();

		if(left != undefined) {
			object.params.x = left;
		}

		if(top != undefined) {
			object.params.y = top;
		}

		_refreshDesignerSize();

	};

	//add a saved product to the load dialog
	var _addSavedProduct = function(thumbnail, product) {

		//create new list item
		var $gridWrapper = $contextDialog.find('.fpd-content-saved-products .fpd-grid');

		$gridWrapper.append('<div class="fpd-item"><picture style="background-image: url('+thumbnail+')" ></picture><div class="fpd-btn fpd-trans"><i class="fpd-icon-remove"></i></div></div>')
		.children('.fpd-item:last').click(function(evt) {

			thisClass.loadProduct($(this).data('product'));
			currentProductIndex = -1;

		}).data('product', product)
		.children('.fpd-btn').click(function(evt) {

			evt.stopPropagation();

			var $item = $(this).parent('.fpd-item'),
				index = $item.parent('.fpd-grid').children('.fpd-item').index($item.remove()),
				savedProducts = _getSavedProducts();

				savedProducts.splice(index, 1);

			window.localStorage.setItem($elem.attr('id'), JSON.stringify(savedProducts));

		});

	};

	//creates a scrollbar or updates it
	var _createScrollbar = function($target) {

		if($target.hasClass('mCSB_container')) {
			$target.mCustomScrollbar('scrollTo', 0);
		}
		else {
			$target.mCustomScrollbar({
				scrollbarPosition: 'outside',
				autoExpandScrollbar: true,
				autoHideScrollbar: true,
				scrollInertia: 200,
				callbacks: {
					onScrollStart: function() {
						$colorPicker.find('input').spectrum('hide');
					},
					whileScrolling: function() {
						if(this.mcs.topPct == 100) {
							_refreshLazyLoad(true);
						}
					}
				}
			});
		}

	};

	//updates the edit box with the parameter values
	var _updateEditorBox = function(element) {

		if($editorBox == undefined) {
			return false;
		}

		var params = element.params;
		$editorBox.find('.fpd-current-element').text(element.title);
		$editorBox.find('.fpd-position').text('x: ' + parseInt(params.x) + ' y: '+ parseInt(params.y));
		$editorBox.find('.fpd-dimensions').text('width: ' + Math.round(element.getWidth()) + ' height: '+ Math.round(element.getHeight()));
		$editorBox.find('.fpd-scale').text(Number(Number(params.scale) % 360).toFixed(2));
		$editorBox.find('.fpd-degree').text(parseInt(params.degree));
		$editorBox.find('.fpd-color').text(params.currentColor);

	};

	//loads custom fonts
	var _renderOnFontLoaded = function(fontName) {

		WebFont.load({
			custom: {
			  families: [fontName]
			},
			fontactive: function(familyName, fvd) {
				$body.mouseup();
				stage.renderAll();
			}
		});

	};

	//checks if an image can be colorized and returns the image type
	var _elementIsColorizable = function(element) {

		if(element.type == 'i-text'  || element.type == 'curvedText') {
			return 'text';
		}

		//check if url is a png or base64 encoded
		var imageParts = element.source.split('.');
		//its base64 encoded
		if(imageParts.length == 1) {
			//check if dataurl is png
			if(imageParts[0].search('data:image/png;') == -1) {
				element.params.currentColor = element.params.colors = false;
				return false;
			}
			else {
				return 'dataurl';
			}
		}
		//its a url
		else {
			//only png and svg are colorizable
			if($.inArray('png', imageParts) == -1 && $.inArray('svg', imageParts) == -1) {
				element.params.currentColor = element.params.colors = false;
				return false;
			}
			else {
				if($.inArray('svg', imageParts) == -1) {
					return 'png';
				}
				else {
					return 'svg';
				}
			}
		}
	};

	//sets the pattern for an object
	var _setPattern = function(element, url) {

		if(element.type == 'image') {

			//todo: find proper solution

		}
		else if(element.type == 'i-text'  || element.type == 'curvedText') {

			if(url) {
				fabric.util.loadImage(url, function(img) {

					element.setFill(new fabric.Pattern({
						source: img,
						repeat: 'repeat'
					}));
					stage.renderAll();
					$body.mouseup();
				});
			}
			else {
				var color = element.params.currentColor ? element.params.currentColor : element.params.colors[0];
				color = color ? color : '#000000';
				element.setFill(color);
			}

		}

	};

	//get the z-position of an element
	var _getZIndex = function(element) {

		var objects = stage.getObjects(),
			zCounter = 0;

		for(var i = 0; i < objects.length; ++i) {
			if(objects[i].visible) {
				if(element === objects[i]) {
					return zCounter;
					break;
				}
				zCounter++;
			}
		}

	};

	//set the z-index of an element
	var _setZIndex = function(element, z) {

		var objects = stage.getObjects(),
			viewZIndexes = 0;

		for(var i=0; i < objects.length; ++i) {
			var object = objects[i];
			//only objects of the current view
			if(object.visible && object.title !== undefined) {
				//detect when required z-index of view reached
				if(viewZIndexes == z) {
					element.moveTo(i);
					break;
				}
				viewZIndexes++;
			}
		}

		_bringToppedElementsToFront();

		//refresh layers list
		i++;
		var nextId = null;
		for(var j=i; j<objects.length; ++j) {
			//get next editable element
			var object = objects[j];
			if(object.isEditable) {
				nextId = object.id;
				break;
			}
		}

		if(nextId !== null) {
			var $nextEditable = _getLayerListItemByID(nextId),
				$targetListItem = _getLayerListItemByID(element.id);

			if($nextEditable && $targetListItem) {
				$targetListItem.insertBefore($nextEditable);
			}

		}

	};

	//adds a new product to the products grid
	var _addGridProduct = function(views) {

		//load product by click
		var $gridWrapper = $contextDialog.find('.fpd-content-products .fpd-grid'),
			lazyClass = options.lazyLoad ? 'fpd-hidden' : '';

		var $lastItem = $gridWrapper.append('<div class="fpd-item fpd-tooltip '+lazyClass+'" title="'+views[0].title+'"><picture data-img="'+views[0].thumbnail+'"></picture></div>')
		.children('.fpd-item:last').click(function(evt) {

			var $this = $(this),
				index = $gridWrapper.children('.fpd-item').index($this);

			thisClass.selectProduct(index);

			evt.preventDefault();

		}).data('views', views);


		if(!options.lazyLoad) {
			_loadImage($lastItem.children('picture'), views[0].thumbnail);
		}

		//show products button in main bar
		if($gridWrapper.children('.fpd-item').length == 2 || !$gridWrapper.parents('.fpd-no-categories').size() > 0) {
			$elem.find('[data-context="products"]').css('display', 'inline-block');
		}

		_updateTooltip();

	};

	//adds a new design to the designs grid
	var _addGridDesign = function(design) {

		var $designsGrid = $contextDialog.find('.fpd-add-design-wrapper .fpd-grid'),
			lazyClass = options.lazyLoad ? 'fpd-hidden' : '';

		var $lastItem = $designsGrid.append('<div class="fpd-item fpd-tooltip '+lazyClass+'" data-source="'+design.source+'" data-title="'+design.title+'" title="'+design.title+'"><picture data-img="'+design.thumbnail+'"></picture></div>')
		.children('.fpd-item:last').click(function(evt) {

			var $this = $(this),
				designParams = $this.data('parameters');

			designParams.isCustom = true;
			thisClass.addElement('image', $this.data('source'), $this.data('title'), designParams, currentViewIndex);

		}).data('parameters', design.parameters);

		if(!options.lazyLoad) {
			_loadImage($lastItem.children('picture'), design.thumbnail);
		}

		_createScrollbar($designsGrid.parent());
		_updateTooltip();

	};

	//log into instagram via a popup
	var _authenticateInstagram = function(callback) {

		var popupLeft = (window.screen.width - 700) / 2,
			popupTop = (window.screen.height - 500) / 2;

		var popup = window.open(options.phpDirectory+'/instagram_auth.php', '', 'width=700,height=500,left='+popupLeft+',top='+popupTop+'');
		_popupBlockerAlert(popup);

		popup.onload = new function() {

			if(window.location.hash.length == 0) {
				popup.open('https://instagram.com/oauth/authorize/?client_id='+options.instagramClientId+'&redirect_uri='+options.instagramRedirectUri+'&response_type=token', '_self');
			}

			var interval = setInterval(function() {
				try {
					if(popup.location.hash.length) {
						clearInterval(interval);
						instaAccessToken = popup.location.hash.slice(14);
						if(localStorageAvailable) {
							window.localStorage.setItem('fpd_instagram_access_token', instaAccessToken);
						}
						popup.close();
						if(callback != undefined && typeof callback == 'function') callback();
					}
				}
				catch(evt) {
					//permission denied
				}

			}, 100);
		}

	};

	//load photos from instagram using an endpoint
	var _loadInstaImages = function(endpoint) {

		$contextLoader.show();

		var endpointUrl;

		switch(endpoint) {
			case 'feed':
				endpointUrl = 'https://api.instagram.com/v1/users/self/feed?access_token='+instaAccessToken;
			break;
			case 'recent':
				endpointUrl = 'https://api.instagram.com/v1/users/self/media/recent?access_token='+instaAccessToken;
			break;
			default:
				endpointUrl = endpoint;
		}

		var $instaPhotosGrid = $contextDialog.find('.fpd-add-instagram-photo-wrapper .fpd-grid'),
			$instaLoadNext = $contextDialog.find('.fpd-add-instagram-photo-wrapper .fpd-insta-load-next');

		$instaPhotosGrid.children('.fpd-item').remove();

		$.ajax({
	        method: 'GET',
	        url: endpointUrl,
	        dataType: 'jsonp',
	        jsonp: 'callback',
	        jsonpCallback: 'jsonpcallback',
	        cache: false,
	        success: function(data) {

	        	if(data.data) {

	        		if(data.pagination && data.pagination.next_url) {
						$instaLoadNext.removeClass('fpd-disabled').data('href', data.pagination.next_url).off('click').on('click', function() {
							_loadInstaImages($(this).data('href'));
							$instaLoadNext.addClass('fpd-disabled').off('click');
						});
	        		}
	        		else {
		        		$instaLoadNext.addClass('fpd-disabled').off('click');
	        		}

		        	$.each(data.data, function(i, item) {
		        		if(item.type == 'image') {

			        		var $lastItem = $instaPhotosGrid.append('<div class="fpd-item" title="'+item.id+'" data-picture="'+item.images.standard_resolution.url+'"><picture></picture>')
			        		.children('.fpd-item:last').click(function(evt) {

								evt.preventDefault();
								$fullLoader.show();

								var $this = $(this);

								$.post(options.phpDirectory + 'get_image_data_url.php', { url: $this.data('picture') }, function(data) {

									if(data && data.error == undefined) {

										var picture = new Image();
										picture.src = data.data_url;
										picture.onload = function() {

											options.customImageParameters.scale = thisClass.getScalingByDimesions(
												this.width,
												this.height,
												options.customImageParameters.resizeToW,
												options.customImageParameters.resizeToH
											);

											thisClass.addCustomImage( this.src, $this.attr('title') );
										};

									}
									else {
										alert(data.error);
									}

								}, 'json')
								.fail(function(evt) {

									$fullLoader.hide();
									alert(evt.statusText);

								});

							});

		        		}

		        		if($lastItem !== undefined) {
			        		_loadImage($lastItem.children('picture'), item.images.thumbnail.url);
			        	}

		        		_createScrollbar($instaPhotosGrid.parent());

		            });

		            $contextLoader.hide();

	        	}
	        	else {
		        	_authenticateInstagram(function() {
			        	_loadInstaImages(endpoint);
		        	});
	        	}

	        },
	        error: function(jqXHR, textStatus, errorThrown) {
	            alert("Could not load data from instagram. Please try again!");
	        }
	    });

	};

	//defines the clipping area
	var _clipElement = function(element) {

		var bbCoords = thisClass.getBoundingBoxCoords(element);
		if(bbCoords) {

			element.clippingRect = bbCoords;
			element.setClipTo(function(ctx) {
				_clipById(ctx, this);
			});

		}

	};

	//draws the clipping
	var _clipById = function (ctx, _this, scale) {

		scale = scale === undefined ? 1 : scale;

	    var clipRect = _this.clippingRect;
	    var scaleXTo1 = (1 / _this.scaleX);
	    var scaleYTo1 = (1 / _this.scaleY);
	    ctx.save();
	    ctx.translate(0,0);
	    ctx.rotate(fabric.util.degreesToRadians(_this.angle * -1));
	    ctx.scale(scaleXTo1, scaleYTo1);
	    ctx.beginPath();
	    ctx.rect(
	        (clipRect.left * responsiveScale) - _this.left - (_this.originX == 'left'? ((_this.width * .5)) * responsiveScale : 0),
	        (clipRect.top * responsiveScale) - _this.top - (_this.originY == 'top' ? ((_this.height * .5)) * responsiveScale : 0),
	        clipRect.width * responsiveScale * scale,
	        clipRect.height * responsiveScale * scale
	    );
	    ctx.fillStyle = 'transparent';
	    ctx.fill();
	    ctx.closePath();
	    ctx.restore();

	};

	/*var _clipById = function (ctx, _this, scale) {

		scale = scale === undefined ? 1 : scale;

	    var clipRect = _this.clippingRect;
	    clipRect.strokeWidth = 0;
		var scaleXTo1 = (1 / _this.scaleX);
		var scaleYTo1 = (1 / _this.scaleY);

		console.log(_this.originX);
		ctx.save();

		var ctxLeft = -( _this.width / 2 );
			var ctxTop = -( _this.height / 2 );
			var ctxWidth = clipRect.width;
			var ctxHeight = clipRect.height;

		ctx.translate( ctxLeft, ctxTop );

		ctx.rotate(fabric.util.degreesToRadians(_this.angle * -1));
		ctx.scale(scaleXTo1, scaleYTo1);
		ctx.beginPath();
		ctx.rect(
		    clipRect.left - _this.oCoords.tl.x,
		    clipRect.top - _this.oCoords.tl.y,
		    clipRect.width,
		    clipRect.height
		);
		ctx.fillStyle = '#990000';
	    ctx.fill();
		ctx.closePath();
		ctx.restore();

	};*/

	//position elements by a given scale
	var _positionElements = function(scale) {

		var objects = stage.getObjects();

		for(var i = 0; i < objects.length; ++i) {
			var object = objects[i];
			if(object.params) {
				object.scaleX = object.params.scale * scale;
		        object.scaleY = object.params.scale * scale;
		        object.left = object.params.x * scale;
		        object.top = object.params.y * scale;
				object.setCoords();
			}
		}

		return objects;

	};

	//brings all topped elements to front
	var _bringToppedElementsToFront = function() {

		var objects = stage.getObjects(),
			bringToFrontObj = [];

		for(var i = 0; i < objects.length; ++i) {
			var object = objects[i];
			if(object.visible && object.params && object.params.topped) {
				bringToFrontObj.push(object);
			}
		}

		for(var i = 0; i < bringToFrontObj.length; ++i) {
			bringToFrontObj[i].bringToFront();
		}

	};

	//checks if the popup blocker is enabled
	var _popupBlockerAlert = function(popup) {

		if (popup == null || typeof(popup)=='undefined') {
			alert('Please disable your pop-up blocker and try again.');
		}

	};

	//checks if a string is an URL
	var _isUrl = function(s) {

		var regexp = /(ftp|http|https):\/\/(\w+:{0,1}\w*@)?(\S+)(:[0-9]+)?(\/|\/([\w#!:.?+=&%@!\-\/]))?/
		return regexp.test(s);

	};

	//updates the options based on the chosen view
	var _updateViewOptions = function(viewOpts) {

		viewOpts = typeof viewOpts === "object" ? viewOpts : {};

		viewOptions = $.extend({}, options, viewOpts);
		viewOptions.elementParameters = $.extend({}, options.elementParameters, viewOptions.elementParameters);
		viewOptions.textParameters = $.extend({}, options.textParameters, viewOptions.textParameters);
		viewOptions.imageParameters = $.extend({}, options.imageParameters, viewOptions.imageParameters);
		viewOptions.customTextParameters = $.extend({}, options.customTextParameters, viewOptions.customTextParameters);
		viewOptions.customImageParameters = $.extend({}, options.customImageParameters, viewOptions.customImageParameters);
		viewOptions.customAdds = $.extend({}, options.customAdds, viewOptions.customAdds);

		thisClass.setStageDimensions(viewOptions.width, viewOptions.stageHeight);

		_updateInterface(viewOptions);

	};

	//update the UI by given options
	var _updateInterface = function(opts) {

		opts = typeof opts == "object" ? opts : {};

		//toggle add options
		$contextDialog.find('.fpd-add-image').toggle(Boolean(opts.customAdds.uploads));
		$contextDialog.find('.fpd-add-text').toggle(Boolean(opts.customAdds.texts));
		$contextDialog.find('.fpd-add-facebook-photo').toggle(Boolean(opts.customAdds.facebook) && _notEmpty(options.facebookAppId));
		$contextDialog.find('.fpd-add-instagram-photo').toggle(Boolean(opts.customAdds.instagram) && _notEmpty(options.instagramClientId));
		$contextDialog.find('.fpd-add-design').toggle(Boolean(opts.customAdds.designs) && $contextDialog.find('.fpd-add-design-wrapper .fpd-item').size() > 0);

		//get all visible add options
		var visibleAdds = $contextDialog.find('.fpd-choose-add > .fpd-btn-raised').filter(function() {
			return $(this).css('display') != 'none';
		});

		//toggle adds button depending on visible add options
		if(visibleAdds.size() > 0) {
			$elem.find('[data-context="adds"]').css('display', 'inline-block');
		}
		else {
			$elem.find('[data-context="adds"]').css('display', 'none');
		}

	};

	var _notEmpty = function(value) {

		if(value === undefined || value === false || value.length == 0) {
			return false;
		}
		return true;

	};

	//update tooltip UI
	var _updateTooltip = function() {

		if(!options.tooltips) {
			return false;
		}

		$('.fpd-tooltip').each(function(i, tooltip) {

			var $tooltip = $(tooltip);
			if($tooltip.hasClass('tooltipstered')) {
				$tooltip.tooltipster('reposition');
			}
			else {
				$tooltip.tooltipster({
					offsetY: 0,
					position: 'bottom',
					theme: '.fpd-tooltip-theme',
					touchDevices: false
				});
			}

		});

	};

	//set the title in the dialog
	var _setDialogTitle = function(title) {

		$contextDialog.find('.fpd-dialog-title').text(title);

	};

	//append a list item to the layers list
	var _appendLayerItem = function(id, title, reorder, removable, isUploadZone, locked) {

		$elem.find('[data-context="layers"]').css('display', 'inline-block');

		var reorderHtml = '<i></i>';
		if(reorder) {
			reorderHtml = '<i class="fpd-icon-reorder"></i>';
		}

		var $layersList = $contextDialog.find('.fpd-content-layers .fpd-list');
		$layersList.append('<div class="fpd-list-row" id="'+id+'"><div class="fpd-cell-0">'+reorderHtml+'</div><div class="fpd-cell-1">'+title+'</div><div class="fpd-cell-2"></div></div>');

		if(isUploadZone) {
			$layersList.find('.fpd-list-row:last').addClass('fpd-add-layer')
			.find('.fpd-cell-2').append('<span><i class="fpd-icon-add"></i></span>');
		}
		else {

			var lockIcon = locked ? 'fpd-icon-locked' : 'fpd-icon-unlocked',
				lockTitle = locked ? options.labels.unlock : options.labels.lock;

			$layersList.find('.fpd-list-row:last .fpd-cell-2').append('<span class="fpd-lock-element fpd-tooltip" title="'+lockTitle+'"><i class="'+lockIcon+'"></i></span>');

			if(removable) {
				$layersList.find('.fpd-list-row:last .fpd-lock-element').after('<span class="fpd-remove-element fpd-tooltip" title="'+options.labels.remove+'"><i class="fpd-icon-remove"></i></span>');
			}

			$layersList.find('.fpd-list-row:last ').addClass(locked ? 'fpd-locked' : '')
			.children('div:lt(2)').css('opacity', locked ? 0.2 : 1).css('pointer-events', locked ? 'none' : 'visible');

		}

		$layersList.sortable( 'refresh' );

		_updateTooltip();

	};

	//gets an upload zone by title
	var _getUploadZone = function(title) {

		var objects = stage.getObjects();
		for(var i=0; i<objects.length; ++i) {
			if(objects[i].params.uploadZone && objects[i].title == title) {
				return objects[i];
				break;
			}
		}

	};

	//checks if browser is IE and return version number
	function _isIE() {

		var myNav = navigator.userAgent.toLowerCase();
		return (myNav.indexOf('msie') != -1) ? parseInt(myNav.split('msie')[1]) : false;

	};

	//toggles an option field
	var _toggleOptionField = function($option, show, value) {

		value = typeof value !== 'undefined' ? value : null;

		$option.parents('.fpd-list-row').toggleClass('fpd-hidden', !show);
		//get related head
		var $relatedHead = $option.parents('.fpd-list-row').prevAll('.fpd-head-options:first');
		//check if a sub option is visible, then show head as well
		if($relatedHead.nextUntil('.fpd-head-options', '.fpd-list-row:not(.fpd-hidden)').size() > 0) {
			$relatedHead.removeClass('fpd-hidden');
		}

		if(value !== null) {

			if($option.hasClass('fpd-slider')) {
				$option.slider('value', value);
			}
			else if(typeof $option.attr('value') !== typeof undefined && $option.attr('value') !== false) {
				$option.val(value).change();
			}

		}

	};

	//refresh whole product designer dimensions - make it responsive
	var _refreshDesignerSize = function() {

		responsiveScale = $elem.outerWidth() < options.width ? $elem.outerWidth() / options.width : 1;
		responsiveScale = Number(responsiveScale.toFixed(2));
		responsiveScale = responsiveScale > 1 ? 1 : responsiveScale;

		stage.setDimensions({width: $elem.width(), height: options.stageHeight * responsiveScale});
		$productStage.height(options.stageHeight * responsiveScale);

		_positionElements(responsiveScale);
		stage.renderAll().calcOffset();

		if($contextDialog.hasClass('fpd-left') || $contextDialog.hasClass('fpd-right')) {

			var leftPos = $contextDialog.hasClass('fpd-left') ? $elem.offset().left+50 : $elem.width() + $elem.offset().left - $contextDialog.width()-50;
			$contextDialog.css({
				left: leftPos,
				top: $mainContainer.offset().top + $mainContainer.height() * .5 - $contextDialog.height() * .5
			});
		}

		if($window.width() < 568) {
			$contextDialog.addClass('fpd-mobile').
			css('top', $elem.offset().top + $elem.height() + 10)
		}
		else {
			$contextDialog.removeClass('fpd-mobile').
			css('top', $mainContainer.offset().top + 10)
		}

	};

	//return an element by ID
	var _getElementByID = function(id) {

		var objects = stage.getObjects();
		for(var i=0; i<objects.length; ++i) {
			if(objects[i].id == id) {
				return objects[i];
				break;
			}
		}

		return false;

	};

	//updates UI of spectrum colorpicker
	var _updateSpectrum = function() {

		$container = $('.sp-container');
		$container.find('.sp-choose').addClass('fpd-secondary-bg-color fpd-secondary-text-color')
		.html('<i class="fpd-icon-done"></i>');
		$container.find('.sp-cancel').html('<i class="fpd-icon-close"></i>');

	};

	//returns the fabrich filter
	var _getFabircFilter = function(type) {

		switch(type) {
			case 'grayscale':
				return new fabric.Image.filters.Grayscale();
			break;
			case 'sepia':
				return new fabric.Image.filters.Sepia();
			break;
			case 'sepia2':
				return new fabric.Image.filters.Sepia2();
			break;
		}

		return null;

	};

	//resets the undo/redo array
	var _resetUndoRedo = function() {

		$elem.find('.fpd-undo, .fpd-redo').addClass('fpd-disabled');
		undos = [];
		redos = [];

	};

	//updates the edit UI
	var _updateEditUI = function() {

		if(!currentElement) {
			return false;
		}

		var parameters = currentElement.params;

		if(parameters.opacity !== undefined) {
			$contextDialog.find('.fpd-opacity-slider').slider('value', parameters.opacity);
		}

		if(parameters.scale !== undefined) {
			$contextDialog.find('.fpd-scale-slider').slider('value', parameters.scale);
		}

		if(parameters.degree !== undefined) {
			$contextDialog.find('.fpd-angle-slider').slider('value', parameters.degree);
		}

		if(parameters.text !== undefined) {

			$contextDialog.find('.fpd-content-layers .fpd-list')
			.children('[id="'+currentElement.id+'"]').children('.fpd-cell-1').text(parameters.text);
			$contextDialog.find('.fpd-change-text').val(parameters.text).change();

		}

		if(parameters.font !== undefined) {
			$contextDialog.find('.fpd-fonts-dropdown').val(parameters.font)
			.next('.select2').find('.select2-selection__rendered').text(parameters.font);
		}

		if(parameters.lineHeight !== undefined) {
			$contextDialog.find('.fpd-line-height-slider').slider('value', parameters.lineHeight);
		}

		if(parameters.textAlign !== undefined) {
			$contextDialog.find('.fpd-set-alignment').children('.fpd-btn').removeClass('fpd-checked')
			.filter('.fpd-text-align-'+parameters.textAlign).addClass('fpd-checked');
		}

		if(parameters.fontWeight !== undefined) {
			$contextDialog.find('.fpd-text-style-bold').toggleClass('fpd-checked', parameters.fontWeight == 'bold');
		}

		if(parameters.fontStyle !== undefined) {
			$contextDialog.find('.fpd-text-style-italic').toggleClass('fpd-checked', parameters.fontStyle == 'italic');
		}

		if(parameters.textDecoration !== undefined) {
			$contextDialog.find('.fpd-text-style-underline').toggleClass('fpd-checked', parameters.textDecoration == 'underline');
		}


		if(parameters.curved) {

			if(parameters.curveRadius) {
				$contextDialog.find('.fpd-curved-text-radius-slider').slider('value', parameters.curveRadius);
			}

			if(parameters.curveSpacing) {
				$contextDialog.find('.fpd-curved-text-spacing-slider').slider('value', parameters.curveSpacing);
			}

			if(parameters.curveReverse !== undefined) {
				$contextDialog.find('.fpd-curved-text-reverse-switcher').toggleClass('fpd-checked', parameters.curveReverse);
			}

		}

	};

	//refresh the items using lazy load
	var _refreshLazyLoad = function(loadByCounter) {

		if($currentLazyLoadContainer == null || $currentLazyLoadContainer.size() == 0) {
			return false;
		}

		var $grid = $currentLazyLoadContainer.find('.fpd-grid'),
			$item = $grid.children('.fpd-item.fpd-hidden:first'),
			counter = 0,
			amount = loadByCounter ? 10 : 0;

		while((counter < amount || $grid.height()-10 < $grid.parents('.fpd-content-main').height()) && $item.size() > 0) {
			var $pic = $item.children('picture');
			$item.removeClass('fpd-hidden');
			_loadImage($pic, $pic.data('img'));
			$item = $item.next('.fpd-item.fpd-hidden');
			counter++;
		}

	};

	//set columns related to container width
	var _setDynamicColumns = function() {

		var contextWidth = $contextDialog.removeClass('fpd-columns-'+$contextDialog.data('columns')).width(),
			newColumns = 3;

		if(contextWidth > 199) {
			newColumns = 1;
		}

		if(contextWidth > 259) {
			newColumns = 2;
		}

		if(contextWidth > 349) {
			newColumns = 3;
		}

		if(contextWidth > 459) {
			newColumns = 4;
		}

		if(contextWidth > 559) {
			newColumns = 5;
		}

		$contextDialog.addClass('fpd-columns-'+newColumns).data('columns', newColumns);

	};

	//add a preloader icon to loading picture and load image
	var _loadImage = function($picture, source) {

		$picture.addClass('fpd-on-loading');
		var image = new Image();
		image.src = source;
		image.onload = function() {
			$picture.attr('data-img', '').removeClass('fpd-on-loading').fadeOut(0)
			.stop().fadeIn(200).css('background-image', 'url("'+this.src+'")');
		};

	};

	//returns a layer list item by id
	var _getLayerListItemByID = function(id) {

		var $item = $contextDialog.find('.fpd-content-layers .fpd-list-row').filter('[id="'+id+'"]');
		return $item.size() === 0 ? null : $item;

	};



	//----------------------------------
	// ------- PUBLIC METHODS ----------
	//----------------------------------


	/**
	 * Returns the bounding box of an element.
	 * @param {fabric.Object} element A fabric object
	 * @return {Object | Boolean} The bounding box object with x,y,width and height or false.
	 */
	FancyProductDesigner.prototype.getBoundingBoxCoords = function(element) {

		var params = element.params;
		if(params.boundingBox || params.uploadZone) {
			var boundingBox;
			if(typeof params.boundingBox == "object") {
				return {
					left: params.boundingBox.x,
					top:params.boundingBox.y,
					width: params.boundingBox.width,
					height: params.boundingBox.height
				};
			}
			else {
				var objects = stage.getObjects();
				for(var i=0; i < objects.length; ++i) {
					//get all layers from first view
					var object = objects[i];
					if(params.boundingBox == object.title) {

						var bbRect = object.getBoundingRect();
						return {
							left: bbRect.left / responsiveScale,
							top: bbRect.top / responsiveScale,
							width: bbRect.width / responsiveScale,
							height: bbRect.height / responsiveScale
						};

						break;
					}
				}
			}
		}

		return false;

	};

	/**
	 * Returns the stage as JSON withn the viewIndex property of every element.
	 * @return {Object} JSON object.
	 */
	FancyProductDesigner.prototype.getFabricJSON = function() {

		thisClass.deselectElement();
		var json = stage.toJSON(['viewIndex']);
		json.width = stage.width;
		json.height = stage.height;

		return json;

	};

	/**
	 * Returns the current price, which is the sum of all element prices.
	 * @return {number} The current price.
	 */
	FancyProductDesigner.prototype.getPrice = function() {

		return currentPrice;

	};

	/**
	 * Returns the current showing product with all views and elements in the views.
	 * @param {boolean} [onlyEditableElements=false] If true, only the editable elements will be returned.
	 * @return {array} An array with all views. A view is an object containing the title, thumbnail, custom options and elements. An element object contains the title, source, parameters and type.
	 */
	FancyProductDesigner.prototype.getProduct = function(onlyEditableElements) {
		 onlyEditableElements = typeof onlyEditableElements !== 'undefined' ? onlyEditableElements : false;

		thisClass.deselectElement();
		thisClass.resetZoom();

		//check if an element is out of his containment - todo: public variable that stores the elements which are out of their containments
		var objects = stage.getObjects();
		for(var i=0; i<objects.length;++i) {
			var object = objects[i];
			if(object.isOut) {
				alert('"'+object.title+'":' + options.labels.outOfContainmentAlert);
				return false;
			}
		}

		var product = [];
		//add views
		for(var i=0; i<currentViews.length; ++i) {
			var view = currentViews[i];
			product.push({title: view.title, thumbnail: view.thumbnail, elements: [], options: view.options});
		}

		for(var i=0; i<objects.length;++i) {
			var object = objects[i];
			var jsonItem = {title: object.title, source: object.source, parameters: object.params, type: (object.type == 'i-text' || object.type == 'curvedText') ? 'text' : 'image'};

			if(object.clipFor == undefined) {
				if(onlyEditableElements) {
					if(object.isEditable) {
						product[object.viewIndex].elements.push(jsonItem);
					}
				}
				else {
					product[object.viewIndex].elements.push(jsonItem);
				}
			}

		}

		//returns an array with all views
		return product;

	};


	/**
	 * Returns the scale value, which is set for the responsive calculation.
	 * @return {number} The responsive scale value.
	 */
	FancyProductDesigner.prototype.getResponsiveScale = function() {

		return responsiveScale;

	};

	/**
	 * Returns the views as data URL.
	 * @param {string} [format=png] The image format for the data URL. Allowed values 'png' and 'jpeg'.
	 * @param {string} [backgroundColor='transparent'] The background color as hexadecimal value. For 'png' you can also use 'transparent'.
	 * @param {number} [multiplier=1] Multiplier to scale by.
	 * @return {array} An array with all views as data URL string.
	 */
	FancyProductDesigner.prototype.getViewsDataURL = function(format, backgroundColor, multiplier) {

		format = typeof format !== 'undefined' ? format : 'png';
		backgroundColor = typeof backgroundColor !== 'undefined' ? backgroundColor : 'transparent';
		multiplier = typeof multiplier !== 'undefined' ? multiplier : 1;

		thisClass.deselectElement();
		thisClass.resetZoom();

		var dataURLs = [],
			tempStageWidth = stage.getWidth(),
			tempStageHeight = stage.getHeight(),
			tempResponsiveScale = responsiveScale;

		stage.setDimensions({width:options.width, height: options.stageHeight}).setBackgroundColor(backgroundColor, function() {

			responsiveScale = 1;
			var objects = _positionElements(1);

			for(var i=0; i<viewsLength;++i) {
				for(var j=0; j<objects.length; ++j) {
					var object = objects[j];
					object.visible = object.viewIndex == i;
				}
				try {
					dataURLs.push(stage.toDataURL({format: format, multiplier: multiplier}));
				}
				catch(evt) {
					alert("Error: Please be sure that the images are hosted under the same domain and protocol, in which you are using the product designer!");
				}

			}

			//hide elements again that are not in the current view index
			for(var i=0; i<objects.length; ++i) {
				var object = objects[i];
				object.visible = object.viewIndex == currentViewIndex;
			}

			responsiveScale = tempResponsiveScale;
			_positionElements(responsiveScale);
			stage.renderAll();
			stage.setDimensions({width: tempStageWidth, height: tempStageHeight}).setBackgroundColor('transparent').renderAll();

		});

		return dataURLs;

	};

	/**
	 * Returns the current visible view as SVG.
	 * @return {string} The current visible view as SVG.
	 */
	FancyProductDesigner.prototype.getViewSVG = function() {

		thisClass.deselectElement();
		thisClass.resetZoom();

		var tempStageWidth = stage.getWidth(),
			tempStageHeight = stage.getHeight(),
			tempResponsiveScale = responsiveScale;

		stage.setDimensions({width: options.width, height: options.stageHeight});

		responsiveScale = 1;
		_positionElements(1);

		for(var i=0; i < stage.getObjects().length; ++i) {
			var object = stage.getObjects()[i];
			if(object.type == 'path-group') {
				object.left = (object.params.x * 1) - object.getWidth() * 0.5;
				object.top = (object.params.y * 1) - object.getHeight() * 0.5;
				object.setCoords();
			}

		}

		var svg = stage.toSVG(),
			$svg = $(svg);

		$svg.children('rect').remove(); //remove bounding boxes
		$svg.children('g').children('[style*="visibility: hidden"]').parent('g').remove(); //remove hidden elements
		svg = $('<div>').append($svg.clone()).html().replace(/(?:\r\n|\r|\n)/g, ''); //replace all newlines

		for(var i=0; i < stage.getObjects().length; ++i) {
		var object = stage.getObjects()[i];
			if(object.type == 'path-group') {
				object.left = (object.params.x * responsiveScale);
				object.top = (object.params.y * responsiveScale);
				object.setCoords();
			}

		}

		responsiveScale = tempResponsiveScale;
		_positionElements(responsiveScale);


		stage.setDimensions({width: tempStageWidth, height: tempStageHeight}).renderAll();

		return svg;

	};

	/**
	 * Returns the views as SVG.
	 * @return {array} An array with all views as SVG.
	 */
	FancyProductDesigner.prototype.getViewsSVG = function() {

		thisClass.deselectElement();
		thisClass.resetZoom();

		var SVGs = [],
			tempStageWidth = stage.getWidth(),
			tempStageHeight = stage.getHeight(),
			tempResponsiveScale = responsiveScale;

		stage.setDimensions({width:options.width, height: options.stageHeight});

		responsiveScale = 1;
		var objects = _positionElements(1);

		for(var i=0; i < viewsLength; ++i) {

			for(var j=0; j<objects.length; ++j) {
				var object = objects[j];
				object.visible = object.viewIndex == i;

				if(object.type == 'path-group') {
					object.left = (object.params.x * 1) - object.getWidth() * 0.5;
					object.top = (object.params.y * 1) - object.getHeight() * 0.5;
					object.setCoords();
				}
			}

			var svg = stage.toSVG(),
				$svg = $(svg);

			$svg.children('rect').remove(); //remove bounding boxes
			$svg.children('g').children('[style*="visibility: hidden"]').parent('g').remove(); //remove hidden elements
			svg = $('<div>').append($svg.clone()).html().replace(/(?:\r\n|\r|\n)/g, '');

			SVGs.push(svg);

		}

		//hide elements again that are not in the current view index
		for(var i=0; i<objects.length; ++i) {
			var object = objects[i];
			object.visible = object.viewIndex == currentViewIndex;

			if(object.type == 'path-group') {
				object.left = (object.params.x * responsiveScale);
				object.top = (object.params.y * responsiveScale);
				object.setCoords();
			}
		}

		responsiveScale = tempResponsiveScale;
		_positionElements(responsiveScale)
		stage.setDimensions({width: tempStageWidth, height: tempStageHeight}).renderAll();

		return SVGs;

	};

	/**
	 * Returns all views in one data URL. The different views will be positioned below each other.
	 * @param {string} [format=png] The image format for the data URL. Allowed values 'png' and 'jpeg'.
	 * @param {string} [backgroundColor=transparent] The background color as hexadecimal value. For 'png' you can also use 'transparent'.
	 * @param {number} [multiplier=1] Multiplier to scale by.
	 * @return {string} One data URL string with all views.
	 */
	FancyProductDesigner.prototype.getProductDataURL = function(format, backgroundColor, multiplier) {

		format = typeof format !== 'undefined' ? format : 'png';
		backgroundColor = typeof backgroundColor !== 'undefined' ? backgroundColor : 'transparent';
		multiplier = typeof multiplier !== 'undefined' ? multiplier : 1;

		thisClass.deselectElement();
		thisClass.resetZoom();
		thisClass.selectView(0);

		var dataUrl,
			tempStageWidth = stage.getWidth(),
			tempStageHeight = stage.getHeight(),
			tempResponsiveScale = responsiveScale;

		stage.setBackgroundColor(backgroundColor, function() {

			//increase stage height and reposition objects
			stage.setDimensions({width: options.width, height: options.stageHeight * viewsLength});

			responsiveScale = 1;
			var objects = _positionElements(1);
			for(var i=0; i<objects.length; ++i) {
				var object = objects[i];
				object.visible = true;
				object.top = object.top + (object.viewIndex * options.stageHeight);
			}

			//get data url
			try {
				dataUrl = stage.toDataURL({format: format, multiplier: multiplier});
			}
			catch(evt) {
				alert("Error: Please be sure that the images are hosted under the same domain and protocol, in which you are using the product designer!");
			}

			//set stage height to default
			for(var i=0; i<objects.length; ++i) {
				var object = objects[i];
				object.visible = object.viewIndex == 0;
				object.top = object.top - (object.viewIndex * options.stageHeight);
			}

			responsiveScale = tempResponsiveScale;
			_positionElements(responsiveScale);
			stage.setDimensions({width: tempStageWidth, height: tempStageHeight}).setBackgroundColor('transparent').renderAll();

		});

		return dataUrl;

	};

	/**
	 * Returns the number of visible products in the context dialog.
	 * @return {number} The number of visible products.
	 */
	FancyProductDesigner.prototype.getProductsLength = function() {

		return $contextDialog.find('.fpd-content-products .fpd-item').size();

	};

	/**
	 * Returns the current visible view. A view contains a title, thumbnail and elements property.
	 * @return {object} An object containing title, thumbail and elements.
	 */
	FancyProductDesigner.prototype.getView = function() {

		return currentViews[currentViewIndex];

	};

	/**
	 * Returns the current visible view as data URL.
	 * @param {string} [format=png] The image format for the data URL. Allowed values 'png' and 'jpeg'.
	 * @param {string} [backgroundColor=transparent] The background color as hexadecimal value. For 'png' you can also use 'transparent'.
	 * @param {number} [multiplier=1] Multiplier to scale by.
	 * @return {string} The current visible as data URL string.
	 */
	FancyProductDesigner.prototype.getViewDataURL = function(format, backgroundColor, multiplier) {

		format = typeof format !== 'undefined' ? format : 'png';
		backgroundColor = typeof backgroundColor !== 'undefined' ? backgroundColor : 'transparent';
		multiplier = typeof multiplier !== 'undefined' ? multiplier : 1;

		thisClass.deselectElement();
		thisClass.resetZoom();

		var dataURL = '',
			tempStageWidth = stage.getWidth(),
			tempStageHeight = stage.getHeight(),
			tempResponsiveScale = responsiveScale;

		stage.setDimensions({width: options.width, height:options.stageHeight}).setBackgroundColor(backgroundColor, function() {

			responsiveScale = 1;
			_positionElements(1);

			try {
				dataURL = stage.toDataURL({format: format, multiplier: multiplier});
			}
			catch(evt) {
				alert("Error: Please be sure that the images are hosted under the same domain and protocol, in which you are using the product designer!");
				return false;
			}

			responsiveScale = tempResponsiveScale;
			_positionElements(responsiveScale);
			stage.setDimensions({width: tempStageWidth, height: tempStageHeight}).setBackgroundColor('transparent').renderAll();

		});

		if(dataURL.length) {
			return dataURL;
		}
		else {
			return false;
		}


	};

	/**
	 * Returns the current selected view index. 0 is the first view index.
	 * @return {number} A number pointing to the current view index.
	 */
	FancyProductDesigner.prototype.getViewIndex = function() {

		return currentViewIndex;

	};

	/**
	 * Returns the fabric canvas used in the product designer.
	 * @return {object} The fabric canvas.
	 */
	FancyProductDesigner.prototype.getStage = function() {

		return stage;

	};

	/**
	 * Returns an array with all custom added elements.
	 * @return {array} An array with objects with the fabric object and the parameters.
	 */
	FancyProductDesigner.prototype.getCustomElements = function() {

		var objects = stage.getObjects(),
			customElements = [];

		for(var i=0; i< objects.length; ++i) {
			var object = objects[i];
			if(object.params && object.params.isCustom) {
				customElements.push({element: object, parameters: object.params});
			}

		}

		return customElements;

	};

	/**
	 * Returns the scale value calculated with the passed image dimensions and the defined "resize-to" dimensions.
	 * @param {number} imgW The width of the image.
	 * @param {number} imgH The height of the image.
	 * @param {number} resizeToW The maximum width for the image.
	 * @param {number} resizeToH The maximum height for the image.
	 * @return {number} The scale value to resize an image to a desired dimension.
	 */
	FancyProductDesigner.prototype.getScalingByDimesions = function(imgW, imgH, resizeToW, resizeToH) {

		var scaling = 1;
		if(imgW > imgH) {
			if(imgW > resizeToW) { scaling = resizeToW / imgW; }
			if(scaling * imgH > resizeToH) { scaling = resizeToH / imgH; }
		}
		else {
			if(imgH > resizeToH) { scaling = resizeToH / imgH; }
			if(scaling * imgW > resizeToW) { scaling = resizeToW / imgW; }
		}

		return scaling;

	};

		/**
	 * Returns the scale value calculated with the passed image dimensions and the defined "resize-to" dimensions.
	 * @return {number} The scale value to resize an image to a desired dimension.
	 */
	FancyProductDesigner.prototype.getViewsOptions = function() {

		var optionsArray = [];
		for(var i=0; i < currentViews.length; ++i) {
			optionsArray.push(currentViews[i].options ? currentViews[i].options : {});
		}

		return optionsArray;

	};

	/**
	 * Adds a new product to the product designer.
	 * @param {array} views An array containing the views for a product. A view is an object with a title, thumbnail and elements property. The elements property is an array containing one or more objects with source, title, parameters and type.
	 * @param {string} [category] If categories are used, you need to define the category title.
	 */
	FancyProductDesigner.prototype.addProduct = function(views, category) {

		//categories are not used
		if($productCategories === null || $productCategories === false) {
			_addGridProduct(views);
		}
		//categories are used
		else {
			category = typeof category == 'undefined' ? $productCategories.val() : category;

			//check if category exists, otherwise create one
			if(productCategories[category] == undefined) {
				productCategories[category] = new Array();
				$productCategories.append('<option value="'+category+'">'+category+'</option>');
			}

			//push product in category object
			productCategories[category].push(views);

			//add product to grid if category is the same like the current showing one
			if($productCategories.val() == category) {
				_addGridProduct(views);
			}
		}

	};

	/**
	 * Loads a new product to the product designer.
	 * @param {array} views An array containing the views for the product.
	 */
	FancyProductDesigner.prototype.loadProduct = function(views) {

		if($fullLoader.is(':visible')) {
			return false;
		}
		productCreated = false;
		$contextDialog.addClass('fpd-hidden');

		if(options.replaceInitialElements) {

			nonInitials = new Array();
			var objects = stage.getObjects();
			for(var i=0; i < objects.length; ++i) {
				var obj = objects[i];
				if(obj.type != 'rect' && !obj.params.isInitial) {
					var elementObj = {
						type: obj.type == 'i-text' ? 'text' : 'image',
						source: obj.source,
						title: obj.title,
						parameters: obj.params
					};
					nonInitials[obj.viewIndex] == undefined ? nonInitials[obj.viewIndex] = new Array(elementObj) : nonInitials[obj.viewIndex].push(elementObj);
				}
			}

		}

		thisClass.clear();
		currentViews = views;

		var viewSelectionHtml = '<div class="fpd-views-selection fpd-grid-contain fpd-clearfix fpd-'+options.viewSelectionPosition+' '+(options.viewSelectionFloated ? 'fpd-float-items' : '')+'"></div>';

		if(options.viewSelectionPosition == 'outside') {
			$elem.after(viewSelectionHtml);
		}
		else {
			$productStage.append(viewSelectionHtml);
		}

		$elem.on('viewCreate', _onViewCreated);

		function _onViewCreated() {
			//add all views of product till views end is reached
			if(viewsLength < currentViews.length) {
				thisClass.addView(currentViews[viewsLength]);
			}
			//all views added
			else {

				$elem.off('viewCreate', _onViewCreated);

				/**
			     * Gets fired as soon as a product has been fully added to the designer.
			     *
			     * @event FancyProductDesigner#productCreate
			     * @param {Event} event
			     * @param {array} currentViews - An array containing all views of the product.
			     */
				$elem.trigger('productCreate', [currentViews]);

				//search for object with auto-select
				var objects = stage.getObjects();
				for(var i=0; i < objects.length; ++i) {
					var obj = objects[i];
					 if(obj.viewIndex == currentViewIndex && obj.params && obj.params.autoSelect) {
						 stage.setActiveObject(obj);
						 obj.setCoords();
					 }
				}

				productCreated = true;
				$contextDialog.removeClass('fpd-hidden');
			}

		};

		thisClass.addView(currentViews[0]);
		thisClass.selectView(0);

	};

	/**
	 * Selects a product from the current visible products in the context dialog.
	 * @param {number} index The requested product by an index value. 0 will load the first product.
	 */
	FancyProductDesigner.prototype.selectProduct = function(index) {
		if(index == currentProductIndex) {	return false; }

		currentProductIndex = index;
		if(index < 0) { currentProductIndex = 0; }
		else if(index > thisClass.getProductsLength()-1) { currentProductIndex = thisClass.getProductsLength()-1; }

		var views = $contextDialog.find('.fpd-content-products .fpd-item').eq(currentProductIndex).data('views');
		thisClass.loadProduct(views);

	};

	/**
	 * Selects a view from the current visible views.
	 * @param {number} index The requested view by an index value. 0 will load the first view.
	 */
	FancyProductDesigner.prototype.selectView = function(index) {

		currentViewIndex = index;
		if(index < 0) { currentViewIndex = 0; }
		else if(index > $viewSelection.children().size()-1) { currentViewIndex = $viewSelection.children().size()-1; }

		thisClass.closeDialog();
		$viewSelection.children('div').removeClass('fpd-view-active')
		.eq(index).addClass('fpd-view-active');

		thisClass.deselectElement();

		var $layersList = $contextDialog.find('.fpd-content-layers .fpd-list').empty();

		var objects = stage.getObjects();
		for(var i=0; i < objects.length; ++i) {
			var object = objects[i];
			//show element if its in the current view
			object.visible = object.viewIndex == currentViewIndex;
			//append a layer list item
			if(object.viewIndex == currentViewIndex && object.isEditable) {
				_appendLayerItem(object.id, object.title, object.params.zChangeable, object.params.removable, object.params.uploadZone, !object.evented);
			}
		}
		stage.renderAll();

		_updateViewOptions(currentViews[currentViewIndex].options);

	};

	/**
	 * Removes a product from the current visible products in the context dialog.
	 * @param {number} index The product to be removed by an index value. 0 will remove the first product.
	 */
	FancyProductDesigner.prototype.removeProduct = function(index) {

		if(index < 0) { index = 0; }
		else if(index > thisClass.getProductsLength()-1) { index = thisClass.getProductsLength()-1; }

		$contextDialog.find('.fpd-content-products .fpd-grid > .fpd-item').eq(index).remove();

		//if product is showing on stage, clear stage
		if(index == currentProductIndex) {
			thisClass.clear();
			currentProductIndex = -1;
		}

	};

	/**
	 * Adds a view to the current visible product.
	 * @param {object} view An object with title, thumbnail and elements properties.
	 */
	FancyProductDesigner.prototype.addView = function(view) {

		viewsLength++;

		$viewSelection = $('.fpd-views-selection');

		$viewSelection.append('<div class="fpd-shadow-1 fpd-item fpd-tooltip" title="'+view.title+'"><picture style="background-image: url('+view.thumbnail+');"></picture></div>')
		.children('div:last').click(function(evt) {

			evt.preventDefault();
			thisClass.selectView($viewSelection.children('div').index($(this)));

		});

		var initialsView = $.merge([], view.elements), //copy
			nonInitialsView = nonInitials[viewsLength-1] ? nonInitials[viewsLength-1] : new Array(), //get non-initial elements
			viewElements = $.merge(([], initialsView), nonInitialsView); //append non-initials to initial elements

		_createSingleView(view.title, viewElements);
		_updateTooltip();

		viewsLength > 1 ? $viewSelection.show() : $viewSelection.hide();

	};

	/**
	 * Adds a new element to the product stage.
	 * @param {string} type The type of an element you would like to add, 'image' or 'text'.
	 * @param {string} source For image the URL to the image and for text elements the default text.
	 * @param {string} title Only required for image elements.
	 * @param {object} [parameters] An object with the parameters, you would like to apply on the element.
	 * @param {number} [viewIndex] The index of the view where the element needs to be added to. If no index is set, it will be added to current showing view.
	 */
	FancyProductDesigner.prototype.addElement = function(type, source, title, params, viewIndex) {

		params = typeof params !== 'undefined' ? params : {}; //todo: change to parameters
		viewIndex = typeof viewIndex !== 'undefined' ? viewIndex : currentViewIndex;

		thisClass.deselectElement();

		if(typeof params != "object") {
			alert("The element "+title+" does not have a valid JSON object as parameters! Please check the syntax, maybe you set quotes wrong.");
			return false;
		}

		//merge default options
		if(type == 'text' || type == 'i-text' || type == 'curvedText') {
			params = $.extend({}, options.elementParameters, options.textParameters, params);
		}
		else {
			params = $.extend({}, options.elementParameters, options.imageParameters, params);
		}

		params.source = source;

		var pushTargetObject = false,
			targetObject = null;

		//store current color and convert colors in string to array
		if(params.colors && typeof params.colors == 'string') {
			//check if string contains hex color values
			if(params.colors.indexOf('#') == 0) {
				//convert string into array
				var colors = params.colors.replace(/\s+/g, '').split(',');
				params.colors = colors;
			}
			else if(viewsLength > 1) {
				//get all layers from first view
				var objects = stage.getObjects();
				for(var i=0; i < objects.length; ++i) {
					var object = objects[i];
					if(object.viewIndex == 0) {
						//look for the target object where to get the color from
						if(params.colors == object.title && targetObject == null) {
							targetObject = object;
							//push all objects in array that should have a color control from the target object
							pushTargetObject = true;
						}
					}
				}
			}
		}

		if(type == 'text' || type == 'i-text' || type == 'curvedText') {
			var defaultTextColor = params.colors[0] ? params.colors[0] : '#000000';
			params.currentColor = params.currentColor ? params.currentColor : defaultTextColor;
		}

		var fabricParams = {
			source: source,
			title: title,
			id: String(new Date().getTime()),
			visible: viewIndex == currentViewIndex,
			viewIndex: viewIndex,
			lockUniScaling: true
		};

		if(options.editorMode) {
			params.removable = params.resizable = params.rotatable = params.zChangeable = true;
		}
		else {
			$.extend(fabricParams, {
				selectable: false,
				lockRotation: true,
				lockScalingX: true,
				lockScalingY: true,
				lockMovementX: true,
				lockMovementY: true,
				hasControls: false,
				evented: false
			});
		}

		if(type == 'image' || type == 'path') {

			$fullLoader.show();

			var _fabricImageLoaded = function(fabricImage, params) {

				var w = fabricImage.width * params.scale,
					h = fabricImage.height * params.scale;


				$.extend(fabricParams, {params: params, originParams: $.extend({}, params), crossOrigin: "anonymous"});
				fabricImage.set(fabricParams);

				//color control for images
				if(pushTargetObject) {
					if(targetObject.colorControlFor) {
						targetObject.colorControlFor.push(fabricImage);
					}
					else {
						targetObject.colorControlFor = [];
						targetObject.colorControlFor.push(fabricImage);
					}
				}

				stage.add(fabricImage);
				$fullLoader.hide();
				thisClass.setElementParameters(fabricImage, fabricImage.params);

				/**
			     * Gets fired as soon as an element has beed added.
			     *
			     * @event FancyProductDesigner#elementAdded
			     * @param {Event} event
			     * @param {fabric.Object} object - The fabric object.
			     */
				$elem.trigger('elementAdded', [fabricImage]);

			};

			var imageParts = source.split('.');
			//load svg from url
			if($.inArray('svg', imageParts) != -1) {
				fabric.loadSVGFromURL(source, function(objects, options) {
					var svgGroup = fabric.util.groupSVGElements(objects, options);
					if(!params.currentColor) {
						params.colors = [];
						for(var i=0; i < objects.length; ++i) {
							var color = tinycolor(objects[i].fill);
							params.colors.push(color.toHexString());
						}
						params.currentColor = params.colors;
					}
					_fabricImageLoaded(svgGroup, params);
				});
			}
			//load png/jpeg from url
			else {
				new fabric.Image.fromURL(source, function(fabricImg) {
					_fabricImageLoaded(fabricImg, params);
				});
			}

		}
		else if(type == 'text' || type == 'i-text' || type == 'curvedText') {

			params.text = params.text ? params.text : params.source;
			params.font = params.font ? params.font : options.fonts[0];
			if(params.font == undefined) {
				params.font = 'Arial';
			}

			$.extend(fabricParams, {
				fontSize: params.textSize,
				fontFamily: params.font,
				fontStyle: params.fontStyle,
				fontWeight: params.fontWeight,
				textAlign: params.textAlign,
				textBackgroundColor: params.textBackgroundColor,
				lineHeight: params.lineHeight,
				textDecoration: params.textDecoration,
				fill: params.currentColor,
				editable: params.editable,
				spacing: params.curveSpacing,
				radius: params.curveRadius,
				reverse: params.curveReverse,
				params: params,
				originParams: $.extend({}, params)
			});

			//make text curved
			if(params.curved) {
				var fabricText = new fabric.CurvedText(params.text.replace(/\\n/g, '\n'), fabricParams);
			}
			//just interactive text
			else {
				var fabricText = new fabric.IText(params.text.replace(/\\n/g, '\n'), fabricParams);

			}

			stage.add(fabricText);
			thisClass.setElementParameters(fabricText, fabricText.params);

			//render font
			_renderOnFontLoaded(params.font);

			$elem.trigger('elementAdded', [fabricText]);
		}
		else {
			alert('Sorry. This type of element is not allowed!');
			return false;
		}

	};

	/**
	 * Adds a new design to the designs dialog.
	 * @param {string} source The URL of the image.
	 * @param {string} title The title for the design.
	 * @param {object} [parameters] An object with the parameters, you would like to apply on the design.
	 * @param {string} [category] If design categories are used, you need to set the category title where you would like to add the design to.
	 * @param {string} [thumbnail] The URL of the thumbnail, if you would like to use another thumbnail instead the actual design image.
	 */
	FancyProductDesigner.prototype.addDesign = function(source, title, parameters, category, thumbnail) {

		parameters = typeof parameters !== 'undefined' ? parameters : {};
		thumbnail = typeof thumbnail == 'undefined' ? source : thumbnail;

		//categories are not used
		if($designCategories === null || $designCategories === false) {
			_addGridDesign({source: source, title: title, parameters: parameters, thumbnail: thumbnail});
		}
		//categories are used
		else {
			category = typeof category == 'undefined' ? $designCategories.val() : category;

			//check if category exists, otherwise create one
			if(designCategories[category] == undefined) {
				designCategories[category] = new Array();
				$designCategories.append('<option value="'+category+'">'+category+'</option>');
			}

			//push design in category object
			designCategories[category].push({source: source, title: title, parameters: parameters, thumbnail: thumbnail});

			//add design to list if category is the same like the current showing one
			if($designCategories.val() == category) {
				_addGridDesign({source: source, title: title, parameters: parameters, thumbnail: thumbnail});
			}
		}

	};

	/**
	 * Adds a new custom image to the product stage. This method should be used if you are using an own image uploader for the product designer. The customImageParameters option will be applied on the images that are added via this method.
	 * @param {string} source The URL of the image.
	 * @param {string} title The title for the design.
	 */
	FancyProductDesigner.prototype.addCustomImage = function(source, title) {

		var $imageInput = $contextDialog.find('.fpd-input-image'),
			image = new Image;
    		image.src = source;

    	$fullLoader.show();

		image.onload = function() {

			var imageH = this.height,
				imageW = this.width,
				scaling = 1;

			if(imageW > viewOptions.customImageParameters.maxW ||
			imageW < viewOptions.customImageParameters.minW ||
			imageH > viewOptions.customImageParameters.maxH ||
			imageH < viewOptions.customImageParameters.minH) {
				$fullLoader.hide();
    			alert(options.labels.uploadedDesignSizeAlert);
    			return false;
			}

			var imageParams = viewOptions.customImageParameters;
			imageParams.scale = thisClass.getScalingByDimesions(imageW, imageH, viewOptions.customImageParameters.resizeToW, viewOptions.customImageParameters.resizeToH);
			imageParams.isCustom = true;

    		thisClass.addElement(
    			'image',
    			source,
    			title,
	    		imageParams
    		);

    		thisClass.addDesign(source, title, imageParams, options.labels.myUploadedImgCat);

		}

		image.onerror = function(evt) {
			alert('Image could not be loaded!');
		}

	};

	/**
	 * Opens the current showing product in a Pop-up window and shows the print dialog.
	 */
	FancyProductDesigner.prototype.print = function() {

		var viewsDataURL = thisClass.getViewsDataURL(),
			images = new Array(),
			imageLoop = 0;

		//load all images first
		for(var i=0; i < viewsDataURL.length; ++i) {

			var image = new Image();
			image.src = viewsDataURL[i];
			image.onload = function() {

				images.push(this);
				imageLoop++;

				//add images to popup and print popup
				if(imageLoop == viewsDataURL.length) {

					var popup = window.open('','','width='+images[0].width+',height='+(images[0].height*viewsDataURL.length)+',location=no,menubar=no,scrollbars=yes,status=no,toolbar=no');
					_popupBlockerAlert(popup);

					popup.document.title = "Print Image";
					for(var j=0; j < images.length; ++j) {
						$(popup.document.body).append('<img src="'+images[j].src+'" />');
					}

					setTimeout(function() {
						popup.print();
					}, 1000);

				}
			}

		}

	};


	/**
	 * Creates an image of the current showing product.
	 * @param {boolean} [openInPopup= true] Opens the image in a Pop-up window.
	 * @param {boolean} [forceDownload=false] Downloads the image to the user's computer.
	 */
	FancyProductDesigner.prototype.createImage = function(openInPopup, forceDownload) {

		if(typeof(openInPopup)==='undefined') openInPopup = true;
		if(typeof(forceDownload)==='undefined') forceDownload = false;

		var dataUrl = thisClass.getProductDataURL();
		var image = new Image();
		image.src = dataUrl;

		image.onload = function() {
			if(openInPopup) {

				var popup = window.open('','','width='+this.width+',height='+this.height+',location=no,menubar=no,scrollbars=yes,status=no,toolbar=no');
				_popupBlockerAlert(popup);

				popup.document.title = "Product Image";
				$(popup.document.body).append('<img src="'+this.src+'" download="product.png" />');

				if(forceDownload) {
					window.location.href = popup.document.getElementsByTagName('img')[0].src.replace('image/png', 'image/octet-stream');
				}
			}

		}

		return image;

	};

	/**
	 * Clears the product stage and resets everything.
	 */
	FancyProductDesigner.prototype.clear = function() {

		thisClass.deselectElement();
		thisClass.resetZoom();
		if($viewSelection) { $viewSelection.remove(); }
		$contextDialog.hide().find('.fpd-content-layers .fpd-list').empty();
		stage.clear();
		viewsLength = currentViewIndex = currentPrice = 0;
		currentViews = currentElement = null;

		/**
	     * Gets fired as soon as the stage has been cleared.
	     *
	     * @event FancyProductDesigner#stageClear
	     * @param {Event} event
	     */
		$elem.trigger('stageClear');
		stageCleared = true;

	};

	/**
	 * Deselects the current selected element.
	 * @param {boolean} [discardActiveObject=true] Discards the active element.
	 */
	FancyProductDesigner.prototype.deselectElement = function(discardActiveObject) {

		discardActiveObject = typeof discardActiveObject == 'undefined' ? true : discardActiveObject;

		_resetUndoRedo();

		$colorPicker.removeClass('fpd-colorpicker-group').empty();
		$elementTooltip.hide();

		if(currentBoundingObject) {
			currentBoundingObject.remove();
			currentBoundingObject = null;
		}

		if(discardActiveObject) {
			stage.discardActiveObject();
		}

		//hide dialog if edit element dialog is visible
		if($contextDialog.find('.fpd-content-edit').is(':visible')) {
			thisClass.closeDialog();
		}
		$contextDialog.find('.fpd-content-edit .fpd-list-row').addClass('fpd-hidden');

		currentElement = null;

		if($editorBox) {
			$editorBox.find('i').text('');
		}

		stage.renderAll().calcOffset();

	};

	/**
	 * Removes an element using the fabric object or the title of an element.
	 * @param {object|string} element Needs to be a fabric object or the title of an element.
	 */
	FancyProductDesigner.prototype.removeElement = function(element) {

		if(typeof element === 'string') {
			element = thisClass.getElementByTitle(element);
		}

		if(element.params.price != 0 && !element.params.uploadZone) {
			currentPrice -= element.params.price;
			$elem.trigger('priceChange', [element.params.price, currentPrice]);
		}

		$contextDialog.find('.fpd-content-layers .fpd-list').children('[id="'+element.id+'"]').remove();

		stage.remove(element);

		if(element.params.hasUploadZone) {

			//check if upload zone contains objects
			var objects = stage.getObjects(),
				uploadZoneEmpty = true;
			for(var i=0; i < objects.length; ++i) {
				var object = objects[i];
				if(object.visible && object.params.replace == element.params.replace) {
					uploadZoneEmpty = false;
					break;
				}
			}
			var uploadZoneObject = _getUploadZone(element.params.replace);

			uploadZoneObject.opacity = uploadZoneEmpty ? 1 : 0;
		}

		/**
	     * Gets fired as soon as an element has been removed.
	     *
	     * @event FancyProductDesigner#elementRemove
	     * @param {Event} event
	     * @param {fabric.Object} element - The fabric object that has been removed.
	     */
		$elem.trigger('elementRemove', [element]);
		thisClass.deselectElement();

	};

	/**
	 * Returns an fabric object by title.
	 * @param {string} title The title of an element.
	 */
	FancyProductDesigner.prototype.getElementByTitle = function(title) {

		var objects = stage.getObjects();
		for(var i = 0; i < objects.length; ++i) {
			if(objects[i].title == title) {
				return objects[i];
				break;
			}
		}

	};

	/**
	 * Sets the zoom of the stage. 1 is equal to no zoom.
	 * @param {number} value The zoom value.
	 */
	FancyProductDesigner.prototype.setZoom = function(value) {

		thisClass.deselectElement();
		var point = new fabric.Point(stage.getWidth() * 0.5, stage.getHeight() * 0.5);
		stage.zoomToPoint(point, value);
		if(value == 1) {
			thisClass.resetZoom();
		}

	};

	/**
	 * Resets the zoom.
	 */
	FancyProductDesigner.prototype.resetZoom = function() {

		thisClass.deselectElement();
		stage.zoomToPoint(new fabric.Point(0, 0), 1);
		stage.absolutePan(new fabric.Point(0, 0));

	};

	/**
	 * Sets the dimensions of the stage(canvas). todo: check
	 * @param {number} width The width for the stage.
	 * @param {number} height The height for the stage.
	 */
	FancyProductDesigner.prototype.setStageDimensions = function(width, height) {

		options.width = width;
		options.stageHeight = height;

		$elem.width(width);
		$productStage.height(height * responsiveScale);
		stage.setDimensions({width: $elem.width(), height: options.stageHeight * responsiveScale})
		.calcOffset().renderAll();

		_refreshDesignerSize();

	};

	/**
	 * Shows a message in the snackbar.
	 * @param {string} text The text for the message.
	 */
	FancyProductDesigner.prototype.showMessage = function(text) {

		var $snackbar;

		if($body.children('.fpd-snackbar-internal').size() > 0) {
			$snackbar = $body.children('.fpd-snackbar');
		}
		else {
			$snackbar = $body.append('<div class="fpd-snackbar-internal fpd-snackbar fpd-shadow-1"><p></p></div>').children('.fpd-snackbar-internal');
		}

		$snackbar.removeClass('fpd-show-up').children('p').html(text).parent().addClass('fpd-show-up');

		setTimeout(function() {
			$snackbar.removeClass('fpd-show-up');
		}, 3000);

	};

	/**
	 * Calls a specified content in the context dialog.
	 * @param {string} target An unique target name. Possible values: 'layers', 'adds', 'products', 'saved-products', 'edit'.
	 * @param {string} title The title for the context dialog, which appears in the head of the context dialog.
	 * @param {string} [subTarget] An unique sub-target name. The 'adds' dialog has following sub-dialogs: 'facebook', 'instagram', 'designs'.
	 * @param {boolean} [deselectElement] Deselects the current selected element.
	 */
	FancyProductDesigner.prototype.callDialogContent = function(target, title, subTarget, deselectElement) {

		subTarget = typeof subTarget !== 'undefined' ? subTarget : null;
		deselectElement = typeof deselectElement !== 'undefined' ? deselectElement : true;

		if(deselectElement) {
			thisClass.deselectElement();
		}

		//hide sub contents
		$contextDialog.find('.fpd-content-sub.fpd-show').removeClass('fpd-show');
		//hide content-back button
		$contextDialog.find('.fpd-content-back').removeClass('fpd-show');

		//get target div
		var $target = $contextDialog.find('.fpd-dialog-content .fpd-content-'+target);
		if($target.is(':hidden')) {
			$target.siblings('div').stop().hide()
			//show requested content div
			$target.stop().fadeIn(300);
		}

		$contextDialog.show();

		//lazy load for products
		if(target == 'products' && options.lazyLoad) {
			$currentLazyLoadContainer = $target;
			_refreshLazyLoad(false);
		}

		if(subTarget) {

			var $subTarget = $contextDialog.find('.fpd-content-sub[data-subContext="'+subTarget+'"]').addClass('fpd-show');
			$contextDialog.find('.fpd-content-back').data('parentTitle', $contextDialog.find('.fpd-dialog-title').text())
			.addClass('fpd-show');

			//lazy load for designs
			$currentLazyLoadContainer = null;
			if(subTarget == 'designs' && options.lazyLoad) {
				$currentLazyLoadContainer = $subTarget;
				_refreshLazyLoad(false);
			}

		}

		_setDialogTitle(title);

	};

	/**
	 * Defines the current upload zone by using the title of a visible upload zone.
	 * @param {string} title The title of a visible upload zone.
	 */
	FancyProductDesigner.prototype.setUploadZone = function(title) {

		currentUploadZone = title;
		thisClass.closeDialog();

	};

	/**
	 * Closes the context dialog box
	 */
	FancyProductDesigner.prototype.closeDialog = function() {

		$contextDialog.hide();
		$colorPicker.find('input').spectrum('hide');
		$currentLazyLoadContainer = null;
		currentUploadZone = null;

	};

	/**
	 * Defines a clipping rectangle for an element.
	 * @param {fabric.Object | string} element A fabric object or the title of an element.
	 * @param {object} clippingRect Ob object containg x, y, width and height values to define the rectangle.
	 * @example
	 * yourDesigner.setClippingRect("Element Title", {x: 100, y: 200, width: 300, height: 400});
	 * @version 3.0.2
	 */
	FancyProductDesigner.prototype.setClippingRect = function(element, clippingRect) {

		//if element is string, get by title
		if(typeof element == 'string') {
			element = thisClass.getElementByTitle(element);
		}

		element.clippingRect = clippingRect;
		stage.renderAll();

	};

	/**
	 * Sets the parameters for a specified element.
	 * @param {fabric.Object | string} element A fabric object or the title of an element.
	 * @param {object} parameters An object with the parameters that should be applied to the element.
	 */
	FancyProductDesigner.prototype.setElementParameters = function(element, parameters) {

		if(element === undefined || parameters === undefined) {
			return false;
		}

		//if element is string, get by title
		if(typeof element == 'string') {
			element = thisClass.getElementByTitle(element);
		}

		//store undos
		if(productCreated) {
			var oldParameters = {};
			for (var key in parameters) {
				oldParameters[key] = element.params[key];
			}
			undos.push({element: element, parameters: oldParameters});
		}

		//adds the element into a upload zone
		if(currentUploadZone && currentUploadZone != '') {

			parameters.z = -1;

			var uploadZoneObj = thisClass.getElementByTitle(currentUploadZone),
				bbRect = uploadZoneObj.getBoundingRect();

			$.extend(parameters, {
					boundingBox: currentUploadZone,
					scale: thisClass.getScalingByDimesions(element.getWidth(), element.getHeight(), (bbRect.width / responsiveScale)-1, (bbRect.height / responsiveScale)-1),
					autoCenter: true,
					removable: true,
					zChangeable: false,
					rotatable: uploadZoneObj.params.rotatable,
					draggable: uploadZoneObj.params.draggable,
					resizable: uploadZoneObj.params.resizable,
					price: uploadZoneObj.params.price,
					replace: currentUploadZone,
					hasUploadZone: true
				}
			);

			uploadZoneObj.opacity = 0;

		}

		//check if a upload zone contains an object
		var objects = stage.getObjects();
		for(var i=0; i < objects.length; ++i) {
			var object = objects[i];
			if(object.params && object.params.uploadZone && object.title == parameters.replace) {
				object.opacity = 0;
			}
		}

		//if topped, z-index can not be changed
		if(parameters.topped) {
			parameters.zChangeable = false;
		}

		//new element added
		if(	typeof parameters.colors === 'object' ||
			parameters.removable ||
			parameters.draggable ||
			parameters.resizable ||
			parameters.rotatable ||
			parameters.zChangeable ||
			parameters.editable ||
			parameters.patternable
			|| parameters.uploadZone) {

			element.isEditable = element.evented = true;
			element.set('selectable', true);


			if(element.viewIndex == currentViewIndex && $contextDialog.find('.fpd-content-layers .fpd-list-row[id="'+element.id+'"]').size() == 0) {
				_appendLayerItem(element.id, element.title, parameters.zChangeable, parameters.removable, parameters.uploadZone, !element.evented);
			}

		}

		if(parameters.opacity !== undefined) {
			element.set('opacity', parameters.opacity);
			//needs to be called for curved text
			if(element.params.curved) {
				element.setFill(element.fill);
			}
		}

		//upload zones have no controls
		if(!parameters.uploadZone || options.editorMode) {

			if(parameters.draggable) {
				element.lockMovementX = element.lockMovementY = false;
			}

			if(parameters.rotatable) {
				element.lockRotation = false;
			}

			if(parameters.resizable) {
				element.lockScalingX = element.lockScalingY = false;
			}

			if((parameters.resizable || parameters.rotatable || parameters.removable)) {
				element.hasControls = true;
			}

		}

		if(parameters.originX) {
			element.setOriginX(parameters.originX);

		}

		if(parameters.originY) {
			element.setOriginY(parameters.originY);
		}

		if(parameters.x !== undefined) {
			element.set('left', parameters.x);
		}

		if(parameters.y !== undefined) {
			element.set('top', parameters.y);
		}

		if(parameters.scale !== undefined) {
			element.set('scaleX', parameters.scale);
			element.set('scaleY', parameters.scale);
		}

		if(parameters.degree !== undefined) {
			element.set('angle', parameters.degree);
		}

		//replace element
		if(parameters.replace && parameters.replace != '' && element.viewIndex === currentViewIndex) {
			var objects = stage.getObjects();
			for(var i = 0; i < objects.length; ++i) {
				var object = objects[i];
				if(object.params != undefined && object.clipFor == undefined && object.params.replace == parameters.replace && object.visible && element !== object) {
					parameters.z = _getZIndex(object);
					parameters.x = object.params.x;
					parameters.y = object.params.y;
					parameters.autoCenter = false;
					thisClass.removeElement(object);
					break;
				}
			}
		}

		//center element
		if(parameters.autoCenter) {
			_doCentering(element);
		}

		if(parameters.flipX !== undefined) {
			element.set('flipX', parameters.flipX);
		}

		if(parameters.flipY !== undefined) {
			element.set('flipY', parameters.flipY);
		}

		if(parameters.price && !parameters.uploadZone) {
			currentPrice += parameters.price;

			/**
		     * Gets fired as soon as the price has changed.
		     *
		     * @event FancyProductDesigner#priceChange
		     * @param {Event} event
		     * @param {number} elementPrice - The price of the element.
		     * @param {number} totalPrice - The total price.
		     */
			$elem.trigger('priceChange', [parameters.price, currentPrice]);
		}

		//change element color
		if(parameters.currentColor !== undefined && parameters.pattern == null) {
			_changeColor(element, parameters.currentColor);
		}

		//set pattern

		if(parameters.pattern !== undefined) {
			_setPattern(element, parameters.pattern);
		}

		//set filter
		if(parameters.filter) {
			element.filters = [];
			var fabricFilter = _getFabircFilter(parameters.filter);
			if(fabricFilter != null) {
				element.filters.push(fabricFilter);
			}
			element.applyFilters(function() {
				stage.renderAll();
				$body.mouseup();
			});
		}

		//clip element
		if((parameters.boundingBox && parameters.boundingBoxClipping) || parameters.hasUploadZone) {
			_clipElement(element);
		}

		//set z position
		if(parameters.z >= 0) {
			_setZIndex(element, parameters.z);
		}

		if(parameters.text) {
			var text = parameters.text;
			if(element.params.maxLength != 0 && text.length > element.params.maxLength) {
				text = text.substr(0, element.params.maxLength);
				element.selectionStart = element.params.maxLength;
			}

			parameters.text = element.title = text;
			element.setText(text);
		}

		if(parameters.font !== undefined) {
			element.setFontFamily(parameters.font);
			_renderOnFontLoaded(parameters.font);
		}

		if(parameters.lineHeight !== undefined) {
			element.set('lineHeight', parameters.lineHeight);
		}

		if(parameters.textAlign !== undefined) {
			element.set('textAlign', parameters.textAlign);
		}

		if(parameters.fontWeight !== undefined) {
			element.set('fontWeight', parameters.fontWeight);
		}

		if(parameters.fontStyle !== undefined) {
			element.set('fontStyle', parameters.fontStyle);
		}

		if(parameters.textDecoration !== undefined) {
			element.set('textDecoration', parameters.textDecoration);
		}

		if(element.params.curved) {

			if(parameters.curveRadius) {
				element.set('radius', parameters.curveRadius);
			}

			if(parameters.curveSpacing) {
				element.set('spacing', parameters.curveSpacing);
			}

			if(parameters.curveReverse !== undefined) {
				element.set('reverse', parameters.curveReverse);
			}

		}

		//select element
		if(parameters.autoSelect && element.isEditable && element.viewIndex == currentViewIndex) {
			stage.setActiveObject(element);
			element.setCoords();
		}

		//check for other topped elements
		_bringToppedElementsToFront();

		//bring element to front
		if(parameters.topped) {
			element.bringToFront();
		}

		for (var key in parameters) {
			element.params[key] = parameters[key];
		}

		element.setCoords();
		stage.renderAll().calcOffset();

		_updateEditUI();
		_checkContainment(element);
		_updateEditorBox(element);
		_refreshDesignerSize();

	};

};

/**
 * @file Fancy Product Designer - jQuery plugin.
 * @version 3.0.0
 * @author {@link http://radykal.de alias Rafael Dery}
 * @requires jQuery
 * @requires {@link http://jqueryui.com/draggable/ jQuery UI Draggable}
 * @requires {@link http://jqueryui.com/sortable/ jQuery UI Sortable}
 * @requires {@link http://jqueryui.com/resizable/ jQuery UI Resizable}
 * @requires {@link http://fabricjs.com fabricjs}
*/

/**
 * @name $
 * @class
 * @description This just documents the method that is added to jQuery by this plugin.
 * See <a href="http://jquery.com/">the jQuery library</a> for full details.
 */

/**
 * @name $.fn
 * @class
 * @memberof $
 * @description This just documents the method that is added to jQuery by this plugin.
 * See <a href="http://jquery.com/">the jQuery library</a> for full details.
 */


;(function($) {

	"use strict";

	/**
	 * Creates a instance of Fancy Product Designer.
	 * @class fancyProductDesigner
	 * @memberOf $.fn
	 * @param {Object} options {@link $.fn.fancyProductDesigner.defaults See default options}
	 * @return {(jQuery | FancyProductDesigner)} An object of jQuery or when adding .data('fpd') to the call an instance {@link FancyProductDesigner} that allows to use the API.
	 * @example
	 * var fpd = $('#fpd').fancyProductDesigner({width: 1200, stageHeight: 800}).data('fpd');
	 * fpd.getProduct();
	 */
	jQuery.fn.fancyProductDesigner = function( options ) {

		return this.each(function() {

			var element = $(this);

            // Return early if this element already has a plugin instance
            if (element.data('fancy-product-designer')) { return };

            var fpd = new FancyProductDesigner(this, options);

            // Store plugin object in this element's data
            element.data('fancy-product-designer', fpd);

		});
	};


	/**
	 * Sets the default options.
	 * @name $.fn.fancyProductDesigner.defaults
	 * @property {number}  [width=900] - The width for the product designer.
	 * @property {number}  [stageHeight=600] - The height for the stage (canvas).
	 * @property {boolean}  [imageDownloadable=true] - Enables the download-image button in the actions list.
	 * @property {boolean}  [saveAsPdf=true] - Enables the save-as-pdf button in the actions list.
	 * @property {boolean}  [printable=true] - Enables the print button in the actions list.
	 * @property {boolean}  [allowProductSaving=true] - Enables the buttons to save and load a product in the actions list.
	 * @property {boolean}  [tooltips=true] - Enables the tooltips.
	 * @property {boolean}  [editorMode=false] - Enables the editor mode. This will make all elements editable and shows a box with some element data.
	 * @property {string}  [viewSelectionPosition='tr'] - The position of the view selection. Possible values: tl,tr,br,bl,outside.
	 * @property {boolean}  [viewSelectionFloated=false] - Floats the items in the view selection.
	 * @property {array}  [fonts=['Arial', 'Helvetica', 'Times New Roman', 'Verdana', 'Geneva']] - The font families you would like to use in the fonts dropdown.
	 * @property {string}  [templatesDirectory='templates/'] - The path to the directory that contains the templates.
	 * @property {string}  [phpDirectory='php/'] - The path to the directory that contains php scripts that are used for some functions of the plugin, like adding facebook/instagram photos and logging into instagram.
	 * @property {array}  [patterns=[]] - An array with the urls to the patterns. Patterns can only be used for text elements.
	 * @property {string}  [facebookAppId=''] - The facebook API ID to allow your users to add photos from facebook.
	 * @property {string}  [instagramClientId=''] - The instagram client ID to allow your users to add photos from instagram. {@link http://instagram.com/developer/ View Instagram documentation}
	 * @property {string}  [instagramRedirectUri=''] - This URI must point to the php/instagram-auth.php.
	 * @property {number}  [zoomStep=0.2] - The step for zooming in and out.
	 * @property {number}  [maxZoom=3] - The maximum zoom.
	 * @property {object}  [hexNames={}] - Set custom names for your hexdecimal colors. key=hexcode without #, value=name of the color (e.g. {000000: 'dark',ffffff:'white'} ).
	 * @property {string}  [selectedColor='#d5d5d5'] - The border color of the selected element.
	 * @property {string}  [boundingBoxColor='#005ede'] - The border color of the bounding box.
	 * @property {string}  [outOfBoundaryColor='#990000'] - The border color of the element when outside of its bounding box.
	 * @property {number}  [paddingControl=10] - The padding of the modification controls when an element is selected.
	 * @property {boolean}  [replaceInitialElements=false] - If using multiple products in one designer and the user adds some custom elements and changes the product base, replace only the initial elements and not the custom added elements.
	 * @property {boolean}  [lazyLoad=true] - Enables lazy loading for product and design items.
	 * @property {object}  [elementParameters] - <pre>x: 0, //the x-position
y: 0, //the y-position
z: -1, //Allows to set the z-index of an element, -1 means it will be added on the stack of layers
opacity: 1, //opacity (0-1)
originX: 'center', //left,center
originY: 'center', //top,center
scale: 1, // the scale factor
degree: 0, //the degree for the rotation
price: 0, //how much does the element cost
colors: false, //false, a string with hex colors separated by commas for static colors or a single color value for enabling the colorpicker
currentColor: false,
removable: false, //false or true
draggable: false,  //false or true
rotatable: false, // false or true
resizable: false,  //false or true
zChangeable: false, //false or true
boundingBox: false, //false, an element by title or an object with x,y,width,height
autoCenter: false, //when the element is added to stage, center it automatically
replace: '', //replaces anelement, if an element is added to stage and another element with the same type and replace parameter enabled is on the stage
boundingBoxClipping: false, //will cut off the area of the element that is outside of the bounding box
autoSelect: false, //select the element when its added to stage
topped: false, //set the element always on top
flipX: false,
flipY: false,
colorPrices: {} //set custom price for selected hexadecimal color, e.g. {"000000": 2, "ffffff": 1.5}</pre>
	 * @property {object}  [textParameters] - The default parameters for all text elements. <pre>
font: false, //If false it will use the first font from the fonts option (alphabetic order), otherwise it will use the font family set here
textSize: 18, //Textsize in px.
patternable: false, //User can choose a pattern for the text element
editable: true, //Can the text be changed by the user?
lineHeight: 1, //line height
textAlign: 'left', //left, center, right
fontWeight: 'normal', //set the font weight - bold or normal
fontStyle: 'normal', //set the font style - italic or normal
textDecoration: 'normal', //normal or underline
maxLength: 0, //the max. allowed characters, 0 means unlimited characters
curved: false, //make text curved
curvable: false, //user can switch between curved and normal text
curveSpacing: 10, //spacing for curved text
curveRadius: 80, //radius for curved text
curveReverse: false //reverse curved</pre>
	 * @property {object}  [imageParameters] - The default parameters for all image elements.<pre>uploadZone: false, //enables an image as an upload zone where users can add images to
filter: false,
filters: [] //'grayscale', 'sepia', 'sepia2'</pre>
	 * @property {object}  [customImageParameters] - The default parameters for all custom added images.<pre>minW: 100, //the minimum upload size width
minH: 100, //the minimum upload size height
maxW: 1500, //the maximum upload size width
maxH: 1500, //the maximum upload size height
resizeToW: 300, //resizes the uploaded image to this width, when width is larger than height
resizeToH: 300 //resizes the uploaded image to this height, when height is larger than width</pre>
	 * @property {object}  [customTextParameters={}] - The default parameters for all custom added text elements.
	 * @property {object}  [customAdds] - Set here what kind of media types the users can add.<pre>
designs: true,
uploads: true,
texts: true,
facebook: true,
instagram: true</pre>
	 * @property {object} [labels] - <pre>
layersButton: 'Manage Layers',
addsButton: 'Add Something',
productsButton: 'Change Products',
downloadImage: 'Download Image',
print: 'Print',
downLoadPDF: 'Download PDF',
saveProduct: 'Save',
loadProduct: 'Load',
undoButton: 'Undo',
redoButton: 'Redo',
resetProductButton: 'Reset Product',
zoomButton: 'Zoom',
panButton: 'Pan',
addImageButton: 'Add your own Image',
addTextButton: 'Add your own text',
enterText: 'Enter your text',
addFBButton: 'Add photo from facebook',
addInstaButton: 'Add photo from instagram',
addDesignButton: 'Choose from Designs',
fillOptions: 'Fill Options',
color: 'Color',
patterns: 'Patterns',
opacity: 'Opacity',
filter: 'Filter',
textOptions: 'Text Options',
changeText: 'Change Text',
typeface: 'Typeface',
lineHeight: 'Line Height',
textAlign: 'Alignment',
textAlignLeft: 'Align Left',
textAlignCenter: 'Align Center',
textAlignRight: 'Align Right',
textStyling: 'Styling',
bold: 'Bold',
italic: 'Italic',
underline: 'Underline',
curvedText: 'Curved Text',
curvedTextSpacing: 'Spacing',
curvedTextRadius: 'Radius',
curvedTextReverse: 'Reverse',
transform: 'Transform',
angle: 'Angle',
scale: 'Scale',
centerH: 'Center Horizontal',
centerV: 'Center Vertical',
flipHorizontal: 'Flip Horizontal',
flipVertical: 'Flip Vertical',
resetElement: 'Reset To His Origin',
fbSelectAlbum: 'Select an album',
instaFeedButton: 'My Feed',
instaRecentImagesButton: 'My Recent Images',
editElement: 'Edit Element',
productSaved: 'Product Saved!',
lock: 'Lock',
unlock: 'Unlock',
remove: 'Remove',
outOfContainmentAlert: 'Move it in his containment!',
uploadedDesignSizeAlert: "Sorry! But the uploaded image size does not conform our indication of size.",
initText: "Initializing product designer",
myUploadedImgCat: "Your uploaded images"</pre>
	 * @example
	 * var fpd = $('#fpd').fancyProductDesigner({elementParameters: {x: 100, draggable: true}, uploadDesigns: false}).data('fpd');
	 */
	$.fn.fancyProductDesigner.defaults = {
		width: 900,
		stageHeight: 600,
		imageDownloadable: true,//shows the button to download the image
		saveAsPdf: true, //shows the button to save product as pdf
		printable: true,//shows the button to print the product
		allowProductSaving: true, //allows the users to save their products in the browser
		tooltips: true, //enable/disable tooltips
		editorMode: false, //enable the editor mode
		viewSelectionPosition: 'tr', //tl,tr,br,bl,outside
		viewSelectionFloated: false, //if true the view selection items will be aligned in one line
		fonts: ['Arial', 'Helvetica', 'Times New Roman', 'Verdana', 'Geneva'], //an array containing all available fonts
		templatesDirectory: 'templates/', //the directory that contains the templates
		phpDirectory: 'php/', //the path to the directory that contains php scripts that are used for some functions of the plugin
		patterns: [], //an array with the urls to the patterns
		facebookAppId: '', //to add photos from facebook, you have to set your own facebook api key
		instagramClientId: '', //the instagram client ID - http://instagram.com/developer/
		instagramRedirectUri: '', //this URI needs to be pointed to the php/instagram-auth.php
		zoomStep: 0.2,
		maxZoom: 3, //the zoom factor. Set it to 1 to hide the zoom buttons in the menu bar
		hexNames: {}, //set custom names for your hexdecimal colors. key=hexcode without #, value: name of the color (e.g. {000000: 'dark'} )
		selectedColor: '#d5d5d5', //the border color of the selected element
		boundingBoxColor: '#005ede', //the border color of the bounding box
		outOfBoundaryColor: '#990000', //the border color of the element when its outside of his bounding box
		paddingControl: 10,
		replaceInitialElements: false,
		lazyLoad: true,
		dialogBoxPositioning: 'dynamic', //dynamic, left or right
		elementParameters: {
			x: 0, //the x-position
			y: 0, //the y-position
			z: -1, //Allows to set the z-index of an element, -1 means it will be added on the stack of layers
			opacity: 1, //opacity (0-1)
			originX: 'center', //left,center
			originY: 'center', //top,center
			scale: 1, // the scale factor
			degree: 0, //the degree for the rotation
			price: 0, //how much does the element cost
			colors: false, //false, a string with hex colors separated by commas for static colors or a single color value for enabling the colorpicker
			currentColor: false,
			removable: false, //false or true
			draggable: false,  //false or true
			rotatable: false, // false or true
			resizable: false,  //false or true
			zChangeable: false, //false or true
			boundingBox: false, //false, an element by title or an object with x,y,width,height
			autoCenter: false, //when the element is added to stage, center it automatically
			replace: '', //replaces anelement, if an element is added to stage and another element with the same type and replace parameter enabled is on the stage
			boundingBoxClipping: false, //will cut off the area of the element that is outside of the bounding box
			autoSelect: false, //select the element when its added to stage
			topped: false, //set the element always on top
			flipX: false,
			flipY: false,
			colorPrices: {}
		},
		textParameters: { //parameters for text elements, will merge with elementParameters
			font: false, //If false it will use the first font from the fonts option (alphabetic order), otherwise it will use the font family set here
			textSize: 18, //Textsize in px.
			patternable: false, //User can choose a pattern for the text element
			editable: true, //Can the text be changed by the user?
			lineHeight: 1, //line height
			textAlign: 'left', //left, center, right
			fontWeight: 'normal', //set the font weight - bold or normal
			fontStyle: 'normal', //set the font style - italic or normal
			textDecoration: 'normal', //normal or underline
			maxLength: 0, //the max. allowed characters, 0 means unlimited characters
			curved: false, //make text curved
			curvable: false, //user can switch between curved and normal text
			curveSpacing: 10, //spacing for curved text
			curveRadius: 80, //radius for curved text
			curveReverse: false //reverse curved
		},
		imageParameters: {
			uploadZone: false, //enables an image as an upload zone where users can add images to
			filter: false,
			filters: [] //'grayscale', 'sepia', 'sepia2'
		},
		customImageParameters: { //additional parameters for uploaded images, will merge with the elementParameters
			minW: 100, //the minimum upload size width
			minH: 100, //the minimum upload size height
			maxW: 1500, //the maximum upload size width
			maxH: 1500, //the maximum upload size height
			resizeToW: 300, //resizes the uploaded image to this width, when width is larger than height
			resizeToH: 300 //resizes the uploaded image to this height, when height is larger than width
		},
		customTextParameters: { //additional parameters for the custom text, will merge with elementParameters and textParameters
		},
		customAdds: {
			designs: true,
			uploads: true,
			texts: true,
			facebook: true,
			instagram: true
		},
		labels: { //different labels used for the UI
			layersButton: 'Manage Layers',
			addsButton: 'Add Something',
			moreButton: 'Actions',
			productsButton: 'Change Products',
			downloadImage: 'Download Image',
			print: 'Print',
			downLoadPDF: 'Download PDF',
			saveProduct: 'Save',
			loadProduct: 'Load',
			undoButton: 'Undo',
			redoButton: 'Redo',
			resetProductButton: 'Reset Product',
			zoomButton: 'Zoom',
			panButton: 'Pan',
			addImageButton: 'Add your own Image',
			addTextButton: 'Add your own text',
			enterText: 'Enter your text',
			addFBButton: 'Add photo from facebook',
			addInstaButton: 'Add photo from instagram',
			addDesignButton: 'Choose from Designs',
			fillOptions: 'Fill Options',
			color: 'Color',
			patterns: 'Patterns',
			opacity: 'Opacity',
			filter: 'Filter',
			textOptions: 'Text Options',
			changeText: 'Change Text',
			typeface: 'Typeface',
			lineHeight: 'Line Height',
			textAlign: 'Alignment',
			textAlignLeft: 'Align Left',
			textAlignCenter: 'Align Center',
			textAlignRight: 'Align Right',
			textStyling: 'Styling',
			bold: 'Bold',
			italic: 'Italic',
			underline: 'Underline',
			curvedText: 'Curved Text',
			curvedTextSpacing: 'Spacing',
			curvedTextRadius: 'Radius',
			curvedTextReverse: 'Reverse',
			transform: 'Transform',
			angle: 'Angle',
			scale: 'Scale',
			centerH: 'Center Horizontal',
			centerV: 'Center Vertical',
			flipHorizontal: 'Flip Horizontal',
			flipVertical: 'Flip Vertical',
			resetElement: 'Reset Element',
			fbSelectAlbum: 'Select an album',
			instaFeedButton: 'My Feed',
			instaRecentImagesButton: 'My Recent Images',
			editElement: 'Edit Element',
			productSaved: 'Product Saved!',
			lock: 'Lock',
			unlock: 'Unlock',
			remove: 'Remove',
			outOfContainmentAlert: 'Move it in his containment!',
			uploadedDesignSizeAlert: "Sorry! But the uploaded image size does not conform our indication of size.",
			initText: "Initializing product designer",
			myUploadedImgCat: "Your uploaded images",
			moveUp: 'Move Up',
			moveDown: 'Move Down'
		}
	};

})(jQuery);